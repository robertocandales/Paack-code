557c1a0c2e8172933d4da64dc35c3e90
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _act = _interopRequireDefault(require("./act"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var isHostElement = function isHostElement(element) {
  return typeof (element === null || element === void 0 ? void 0 : element.type) === 'string';
};

var isTextInput = function isTextInput(element) {
  var _require = require('react-native'),
      TextInput = _require.TextInput;

  return (element === null || element === void 0 ? void 0 : element.type) === TextInput;
};

var isTouchResponder = function isTouchResponder(element) {
  if (!isHostElement(element)) return false;
  return !!(element !== null && element !== void 0 && element.props.onStartShouldSetResponder) || isTextInput(element);
};

var isPointerEventEnabled = function isPointerEventEnabled(element, isParent) {
  var parentCondition = isParent ? (element === null || element === void 0 ? void 0 : element.props.pointerEvents) === 'box-only' : (element === null || element === void 0 ? void 0 : element.props.pointerEvents) === 'box-none';

  if ((element === null || element === void 0 ? void 0 : element.props.pointerEvents) === 'none' || parentCondition) {
    return false;
  }

  if (!(element !== null && element !== void 0 && element.parent)) return true;
  return isPointerEventEnabled(element.parent, true);
};

var isEventEnabled = function isEventEnabled(element, touchResponder) {
  var _touchResponder$props, _touchResponder$props2, _touchResponder$props3, _touchResponder$props4;

  if (isTextInput(element)) return (element === null || element === void 0 ? void 0 : element.props.editable) !== false;
  if (!isPointerEventEnabled(element)) return false;
  var touchStart = touchResponder === null || touchResponder === void 0 ? void 0 : (_touchResponder$props = (_touchResponder$props2 = touchResponder.props).onStartShouldSetResponder) === null || _touchResponder$props === void 0 ? void 0 : _touchResponder$props.call(_touchResponder$props2);
  var touchMove = touchResponder === null || touchResponder === void 0 ? void 0 : (_touchResponder$props3 = (_touchResponder$props4 = touchResponder.props).onMoveShouldSetResponder) === null || _touchResponder$props3 === void 0 ? void 0 : _touchResponder$props3.call(_touchResponder$props4);
  if (touchStart || touchMove) return true;
  return touchStart === undefined && touchMove === undefined;
};

var findEventHandler = function findEventHandler(element, eventName, callsite, nearestTouchResponder) {
  var touchResponder = isTouchResponder(element) ? element : nearestTouchResponder;
  var handler = getEventHandler(element, eventName);
  if (handler && isEventEnabled(element, touchResponder)) return handler;

  if (element.parent === null || element.parent.parent === null) {
    return null;
  }

  return findEventHandler(element.parent, eventName, callsite, touchResponder);
};

var getEventHandler = function getEventHandler(element, eventName) {
  var eventHandlerName = toEventHandlerName(eventName);

  if (typeof element.props[eventHandlerName] === 'function') {
    return element.props[eventHandlerName];
  }

  if (typeof element.props[eventName] === 'function') {
    return element.props[eventName];
  }

  return undefined;
};

var invokeEvent = function invokeEvent(element, eventName, callsite) {
  for (var _len = arguments.length, data = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {
    data[_key - 3] = arguments[_key];
  }

  var handler = findEventHandler(element, eventName, callsite);

  if (!handler) {
    return;
  }

  var returnValue;
  (0, _act.default)(function () {
    returnValue = handler.apply(void 0, data);
  });
  return returnValue;
};

var toEventHandlerName = function toEventHandlerName(eventName) {
  return "on" + eventName.charAt(0).toUpperCase() + eventName.slice(1);
};

var pressHandler = function pressHandler(element) {
  for (var _len2 = arguments.length, data = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
    data[_key2 - 1] = arguments[_key2];
  }

  return invokeEvent.apply(void 0, [element, 'press', pressHandler].concat(data));
};

var changeTextHandler = function changeTextHandler(element) {
  for (var _len3 = arguments.length, data = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
    data[_key3 - 1] = arguments[_key3];
  }

  return invokeEvent.apply(void 0, [element, 'changeText', changeTextHandler].concat(data));
};

var scrollHandler = function scrollHandler(element) {
  for (var _len4 = arguments.length, data = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
    data[_key4 - 1] = arguments[_key4];
  }

  return invokeEvent.apply(void 0, [element, 'scroll', scrollHandler].concat(data));
};

var fireEvent = function fireEvent(element, eventName) {
  for (var _len5 = arguments.length, data = new Array(_len5 > 2 ? _len5 - 2 : 0), _key5 = 2; _key5 < _len5; _key5++) {
    data[_key5 - 2] = arguments[_key5];
  }

  return invokeEvent.apply(void 0, [element, eventName, fireEvent].concat(data));
};

fireEvent.press = pressHandler;
fireEvent.changeText = changeTextHandler;
fireEvent.scroll = scrollHandler;
var _default = fireEvent;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpcmVFdmVudC5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfYWN0IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJvYmoiLCJfX2VzTW9kdWxlIiwiaXNIb3N0RWxlbWVudCIsImVsZW1lbnQiLCJ0eXBlIiwiaXNUZXh0SW5wdXQiLCJUZXh0SW5wdXQiLCJpc1RvdWNoUmVzcG9uZGVyIiwicHJvcHMiLCJvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwiaXNQb2ludGVyRXZlbnRFbmFibGVkIiwiaXNQYXJlbnQiLCJwYXJlbnRDb25kaXRpb24iLCJwb2ludGVyRXZlbnRzIiwicGFyZW50IiwiaXNFdmVudEVuYWJsZWQiLCJ0b3VjaFJlc3BvbmRlciIsIl90b3VjaFJlc3BvbmRlciRwcm9wcyIsIl90b3VjaFJlc3BvbmRlciRwcm9wczIiLCJfdG91Y2hSZXNwb25kZXIkcHJvcHMzIiwiX3RvdWNoUmVzcG9uZGVyJHByb3BzNCIsImVkaXRhYmxlIiwidG91Y2hTdGFydCIsImNhbGwiLCJ0b3VjaE1vdmUiLCJvbk1vdmVTaG91bGRTZXRSZXNwb25kZXIiLCJ1bmRlZmluZWQiLCJmaW5kRXZlbnRIYW5kbGVyIiwiZXZlbnROYW1lIiwiY2FsbHNpdGUiLCJuZWFyZXN0VG91Y2hSZXNwb25kZXIiLCJoYW5kbGVyIiwiZ2V0RXZlbnRIYW5kbGVyIiwiZXZlbnRIYW5kbGVyTmFtZSIsInRvRXZlbnRIYW5kbGVyTmFtZSIsImludm9rZUV2ZW50IiwiZGF0YSIsInJldHVyblZhbHVlIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsInByZXNzSGFuZGxlciIsImNoYW5nZVRleHRIYW5kbGVyIiwic2Nyb2xsSGFuZGxlciIsImZpcmVFdmVudCIsInByZXNzIiwiY2hhbmdlVGV4dCIsInNjcm9sbCIsIl9kZWZhdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLElBQUksR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sU0FBUixDQUFqQzs7QUFFQSxTQUFTRCxzQkFBVCxDQUFnQ0UsR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ0MsVUFBWCxHQUF3QkQsR0FBeEIsR0FBOEI7QUFBRUosSUFBQUEsT0FBTyxFQUFFSTtBQUFYLEdBQXJDO0FBQXdEOztBQUUvRixJQUFNRSxhQUFhLEdBQUcsU0FBaEJBLGFBQWdCLENBQUFDLE9BQU8sRUFBSTtBQUMvQixTQUFPLFFBQVFBLE9BQU8sS0FBSyxJQUFaLElBQW9CQSxPQUFPLEtBQUssS0FBSyxDQUFyQyxHQUF5QyxLQUFLLENBQTlDLEdBQWtEQSxPQUFPLENBQUNDLElBQWxFLE1BQTRFLFFBQW5GO0FBQ0QsQ0FGRDs7QUFJQSxJQUFNQyxXQUFXLEdBQUcsU0FBZEEsV0FBYyxDQUFBRixPQUFPLEVBQUk7QUFDN0IsaUJBRUlKLE9BQU8sQ0FBQyxjQUFELENBRlg7QUFBQSxNQUNFTyxTQURGLFlBQ0VBLFNBREY7O0FBSUEsU0FBTyxDQUFDSCxPQUFPLEtBQUssSUFBWixJQUFvQkEsT0FBTyxLQUFLLEtBQUssQ0FBckMsR0FBeUMsS0FBSyxDQUE5QyxHQUFrREEsT0FBTyxDQUFDQyxJQUEzRCxNQUFxRUUsU0FBNUU7QUFDRCxDQU5EOztBQVFBLElBQU1DLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUIsQ0FBQUosT0FBTyxFQUFJO0FBQ2xDLE1BQUksQ0FBQ0QsYUFBYSxDQUFDQyxPQUFELENBQWxCLEVBQTZCLE9BQU8sS0FBUDtBQUM3QixTQUFPLENBQUMsRUFBRUEsT0FBTyxLQUFLLElBQVosSUFBb0JBLE9BQU8sS0FBSyxLQUFLLENBQXJDLElBQTBDQSxPQUFPLENBQUNLLEtBQVIsQ0FBY0MseUJBQTFELENBQUQsSUFBeUZKLFdBQVcsQ0FBQ0YsT0FBRCxDQUEzRztBQUNELENBSEQ7O0FBS0EsSUFBTU8scUJBQXFCLEdBQUcsU0FBeEJBLHFCQUF3QixDQUFDUCxPQUFELEVBQVVRLFFBQVYsRUFBdUI7QUFDbkQsTUFBTUMsZUFBZSxHQUFHRCxRQUFRLEdBQUcsQ0FBQ1IsT0FBTyxLQUFLLElBQVosSUFBb0JBLE9BQU8sS0FBSyxLQUFLLENBQXJDLEdBQXlDLEtBQUssQ0FBOUMsR0FBa0RBLE9BQU8sQ0FBQ0ssS0FBUixDQUFjSyxhQUFqRSxNQUFvRixVQUF2RixHQUFvRyxDQUFDVixPQUFPLEtBQUssSUFBWixJQUFvQkEsT0FBTyxLQUFLLEtBQUssQ0FBckMsR0FBeUMsS0FBSyxDQUE5QyxHQUFrREEsT0FBTyxDQUFDSyxLQUFSLENBQWNLLGFBQWpFLE1BQW9GLFVBQXhOOztBQUVBLE1BQUksQ0FBQ1YsT0FBTyxLQUFLLElBQVosSUFBb0JBLE9BQU8sS0FBSyxLQUFLLENBQXJDLEdBQXlDLEtBQUssQ0FBOUMsR0FBa0RBLE9BQU8sQ0FBQ0ssS0FBUixDQUFjSyxhQUFqRSxNQUFvRixNQUFwRixJQUE4RkQsZUFBbEcsRUFBbUg7QUFDakgsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsTUFBSSxFQUFFVCxPQUFPLEtBQUssSUFBWixJQUFvQkEsT0FBTyxLQUFLLEtBQUssQ0FBckMsSUFBMENBLE9BQU8sQ0FBQ1csTUFBcEQsQ0FBSixFQUFpRSxPQUFPLElBQVA7QUFDakUsU0FBT0oscUJBQXFCLENBQUNQLE9BQU8sQ0FBQ1csTUFBVCxFQUFpQixJQUFqQixDQUE1QjtBQUNELENBVEQ7O0FBV0EsSUFBTUMsY0FBYyxHQUFHLFNBQWpCQSxjQUFpQixDQUFDWixPQUFELEVBQVVhLGNBQVYsRUFBNkI7QUFDbEQsTUFBSUMscUJBQUosRUFBMkJDLHNCQUEzQixFQUFtREMsc0JBQW5ELEVBQTJFQyxzQkFBM0U7O0FBRUEsTUFBSWYsV0FBVyxDQUFDRixPQUFELENBQWYsRUFBMEIsT0FBTyxDQUFDQSxPQUFPLEtBQUssSUFBWixJQUFvQkEsT0FBTyxLQUFLLEtBQUssQ0FBckMsR0FBeUMsS0FBSyxDQUE5QyxHQUFrREEsT0FBTyxDQUFDSyxLQUFSLENBQWNhLFFBQWpFLE1BQStFLEtBQXRGO0FBQzFCLE1BQUksQ0FBQ1gscUJBQXFCLENBQUNQLE9BQUQsQ0FBMUIsRUFBcUMsT0FBTyxLQUFQO0FBQ3JDLE1BQU1tQixVQUFVLEdBQUdOLGNBQWMsS0FBSyxJQUFuQixJQUEyQkEsY0FBYyxLQUFLLEtBQUssQ0FBbkQsR0FBdUQsS0FBSyxDQUE1RCxHQUFnRSxDQUFDQyxxQkFBcUIsR0FBRyxDQUFDQyxzQkFBc0IsR0FBR0YsY0FBYyxDQUFDUixLQUF6QyxFQUFnREMseUJBQXpFLE1BQXdHLElBQXhHLElBQWdIUSxxQkFBcUIsS0FBSyxLQUFLLENBQS9JLEdBQW1KLEtBQUssQ0FBeEosR0FBNEpBLHFCQUFxQixDQUFDTSxJQUF0QixDQUEyQkwsc0JBQTNCLENBQS9PO0FBQ0EsTUFBTU0sU0FBUyxHQUFHUixjQUFjLEtBQUssSUFBbkIsSUFBMkJBLGNBQWMsS0FBSyxLQUFLLENBQW5ELEdBQXVELEtBQUssQ0FBNUQsR0FBZ0UsQ0FBQ0csc0JBQXNCLEdBQUcsQ0FBQ0Msc0JBQXNCLEdBQUdKLGNBQWMsQ0FBQ1IsS0FBekMsRUFBZ0RpQix3QkFBMUUsTUFBd0csSUFBeEcsSUFBZ0hOLHNCQUFzQixLQUFLLEtBQUssQ0FBaEosR0FBb0osS0FBSyxDQUF6SixHQUE2SkEsc0JBQXNCLENBQUNJLElBQXZCLENBQTRCSCxzQkFBNUIsQ0FBL087QUFDQSxNQUFJRSxVQUFVLElBQUlFLFNBQWxCLEVBQTZCLE9BQU8sSUFBUDtBQUM3QixTQUFPRixVQUFVLEtBQUtJLFNBQWYsSUFBNEJGLFNBQVMsS0FBS0UsU0FBakQ7QUFDRCxDQVREOztBQVdBLElBQU1DLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUIsQ0FBQ3hCLE9BQUQsRUFBVXlCLFNBQVYsRUFBcUJDLFFBQXJCLEVBQStCQyxxQkFBL0IsRUFBeUQ7QUFDaEYsTUFBTWQsY0FBYyxHQUFHVCxnQkFBZ0IsQ0FBQ0osT0FBRCxDQUFoQixHQUE0QkEsT0FBNUIsR0FBc0MyQixxQkFBN0Q7QUFDQSxNQUFNQyxPQUFPLEdBQUdDLGVBQWUsQ0FBQzdCLE9BQUQsRUFBVXlCLFNBQVYsQ0FBL0I7QUFDQSxNQUFJRyxPQUFPLElBQUloQixjQUFjLENBQUNaLE9BQUQsRUFBVWEsY0FBVixDQUE3QixFQUF3RCxPQUFPZSxPQUFQOztBQUV4RCxNQUFJNUIsT0FBTyxDQUFDVyxNQUFSLEtBQW1CLElBQW5CLElBQTJCWCxPQUFPLENBQUNXLE1BQVIsQ0FBZUEsTUFBZixLQUEwQixJQUF6RCxFQUErRDtBQUM3RCxXQUFPLElBQVA7QUFDRDs7QUFFRCxTQUFPYSxnQkFBZ0IsQ0FBQ3hCLE9BQU8sQ0FBQ1csTUFBVCxFQUFpQmMsU0FBakIsRUFBNEJDLFFBQTVCLEVBQXNDYixjQUF0QyxDQUF2QjtBQUNELENBVkQ7O0FBWUEsSUFBTWdCLGVBQWUsR0FBRyxTQUFsQkEsZUFBa0IsQ0FBQzdCLE9BQUQsRUFBVXlCLFNBQVYsRUFBd0I7QUFDOUMsTUFBTUssZ0JBQWdCLEdBQUdDLGtCQUFrQixDQUFDTixTQUFELENBQTNDOztBQUVBLE1BQUksT0FBT3pCLE9BQU8sQ0FBQ0ssS0FBUixDQUFjeUIsZ0JBQWQsQ0FBUCxLQUEyQyxVQUEvQyxFQUEyRDtBQUN6RCxXQUFPOUIsT0FBTyxDQUFDSyxLQUFSLENBQWN5QixnQkFBZCxDQUFQO0FBQ0Q7O0FBRUQsTUFBSSxPQUFPOUIsT0FBTyxDQUFDSyxLQUFSLENBQWNvQixTQUFkLENBQVAsS0FBb0MsVUFBeEMsRUFBb0Q7QUFDbEQsV0FBT3pCLE9BQU8sQ0FBQ0ssS0FBUixDQUFjb0IsU0FBZCxDQUFQO0FBQ0Q7O0FBRUQsU0FBT0YsU0FBUDtBQUNELENBWkQ7O0FBY0EsSUFBTVMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQ2hDLE9BQUQsRUFBVXlCLFNBQVYsRUFBcUJDLFFBQXJCLEVBQTJDO0FBQUEsb0NBQVRPLElBQVM7QUFBVEEsSUFBQUEsSUFBUztBQUFBOztBQUM3RCxNQUFNTCxPQUFPLEdBQUdKLGdCQUFnQixDQUFDeEIsT0FBRCxFQUFVeUIsU0FBVixFQUFxQkMsUUFBckIsQ0FBaEM7O0FBRUEsTUFBSSxDQUFDRSxPQUFMLEVBQWM7QUFDWjtBQUNEOztBQUVELE1BQUlNLFdBQUo7QUFDQSxHQUFDLEdBQUd4QyxJQUFJLENBQUNELE9BQVQsRUFBa0IsWUFBTTtBQUN0QnlDLElBQUFBLFdBQVcsR0FBR04sT0FBTyxNQUFQLFNBQVdLLElBQVgsQ0FBZDtBQUNELEdBRkQ7QUFHQSxTQUFPQyxXQUFQO0FBQ0QsQ0FaRDs7QUFjQSxJQUFNSCxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLENBQUFOLFNBQVM7QUFBQSxnQkFBU0EsU0FBUyxDQUFDVSxNQUFWLENBQWlCLENBQWpCLEVBQW9CQyxXQUFwQixFQUFULEdBQTZDWCxTQUFTLENBQUNZLEtBQVYsQ0FBZ0IsQ0FBaEIsQ0FBN0M7QUFBQSxDQUFwQzs7QUFFQSxJQUFNQyxZQUFZLEdBQUcsU0FBZkEsWUFBZSxDQUFDdEMsT0FBRDtBQUFBLHFDQUFhaUMsSUFBYjtBQUFhQSxJQUFBQSxJQUFiO0FBQUE7O0FBQUEsU0FBc0JELFdBQVcsTUFBWCxVQUFZaEMsT0FBWixFQUFxQixPQUFyQixFQUE4QnNDLFlBQTlCLFNBQStDTCxJQUEvQyxFQUF0QjtBQUFBLENBQXJCOztBQUVBLElBQU1NLGlCQUFpQixHQUFHLFNBQXBCQSxpQkFBb0IsQ0FBQ3ZDLE9BQUQ7QUFBQSxxQ0FBYWlDLElBQWI7QUFBYUEsSUFBQUEsSUFBYjtBQUFBOztBQUFBLFNBQXNCRCxXQUFXLE1BQVgsVUFBWWhDLE9BQVosRUFBcUIsWUFBckIsRUFBbUN1QyxpQkFBbkMsU0FBeUROLElBQXpELEVBQXRCO0FBQUEsQ0FBMUI7O0FBRUEsSUFBTU8sYUFBYSxHQUFHLFNBQWhCQSxhQUFnQixDQUFDeEMsT0FBRDtBQUFBLHFDQUFhaUMsSUFBYjtBQUFhQSxJQUFBQSxJQUFiO0FBQUE7O0FBQUEsU0FBc0JELFdBQVcsTUFBWCxVQUFZaEMsT0FBWixFQUFxQixRQUFyQixFQUErQndDLGFBQS9CLFNBQWlEUCxJQUFqRCxFQUF0QjtBQUFBLENBQXRCOztBQUVBLElBQU1RLFNBQVMsR0FBRyxTQUFaQSxTQUFZLENBQUN6QyxPQUFELEVBQVV5QixTQUFWO0FBQUEscUNBQXdCUSxJQUF4QjtBQUF3QkEsSUFBQUEsSUFBeEI7QUFBQTs7QUFBQSxTQUFpQ0QsV0FBVyxNQUFYLFVBQVloQyxPQUFaLEVBQXFCeUIsU0FBckIsRUFBZ0NnQixTQUFoQyxTQUE4Q1IsSUFBOUMsRUFBakM7QUFBQSxDQUFsQjs7QUFFQVEsU0FBUyxDQUFDQyxLQUFWLEdBQWtCSixZQUFsQjtBQUNBRyxTQUFTLENBQUNFLFVBQVYsR0FBdUJKLGlCQUF2QjtBQUNBRSxTQUFTLENBQUNHLE1BQVYsR0FBbUJKLGFBQW5CO0FBQ0EsSUFBSUssUUFBUSxHQUFHSixTQUFmO0FBQ0FsRCxPQUFPLENBQUNFLE9BQVIsR0FBa0JvRCxRQUFsQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX2FjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vYWN0XCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuY29uc3QgaXNIb3N0RWxlbWVudCA9IGVsZW1lbnQgPT4ge1xuICByZXR1cm4gdHlwZW9mIChlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQudHlwZSkgPT09ICdzdHJpbmcnO1xufTtcblxuY29uc3QgaXNUZXh0SW5wdXQgPSBlbGVtZW50ID0+IHtcbiAgY29uc3Qge1xuICAgIFRleHRJbnB1dFxuICB9ID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJyk7XG5cbiAgcmV0dXJuIChlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQudHlwZSkgPT09IFRleHRJbnB1dDtcbn07XG5cbmNvbnN0IGlzVG91Y2hSZXNwb25kZXIgPSBlbGVtZW50ID0+IHtcbiAgaWYgKCFpc0hvc3RFbGVtZW50KGVsZW1lbnQpKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiAhIShlbGVtZW50ICE9PSBudWxsICYmIGVsZW1lbnQgIT09IHZvaWQgMCAmJiBlbGVtZW50LnByb3BzLm9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXIpIHx8IGlzVGV4dElucHV0KGVsZW1lbnQpO1xufTtcblxuY29uc3QgaXNQb2ludGVyRXZlbnRFbmFibGVkID0gKGVsZW1lbnQsIGlzUGFyZW50KSA9PiB7XG4gIGNvbnN0IHBhcmVudENvbmRpdGlvbiA9IGlzUGFyZW50ID8gKGVsZW1lbnQgPT09IG51bGwgfHwgZWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWxlbWVudC5wcm9wcy5wb2ludGVyRXZlbnRzKSA9PT0gJ2JveC1vbmx5JyA6IChlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQucHJvcHMucG9pbnRlckV2ZW50cykgPT09ICdib3gtbm9uZSc7XG5cbiAgaWYgKChlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQucHJvcHMucG9pbnRlckV2ZW50cykgPT09ICdub25lJyB8fCBwYXJlbnRDb25kaXRpb24pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIShlbGVtZW50ICE9PSBudWxsICYmIGVsZW1lbnQgIT09IHZvaWQgMCAmJiBlbGVtZW50LnBhcmVudCkpIHJldHVybiB0cnVlO1xuICByZXR1cm4gaXNQb2ludGVyRXZlbnRFbmFibGVkKGVsZW1lbnQucGFyZW50LCB0cnVlKTtcbn07XG5cbmNvbnN0IGlzRXZlbnRFbmFibGVkID0gKGVsZW1lbnQsIHRvdWNoUmVzcG9uZGVyKSA9PiB7XG4gIHZhciBfdG91Y2hSZXNwb25kZXIkcHJvcHMsIF90b3VjaFJlc3BvbmRlciRwcm9wczIsIF90b3VjaFJlc3BvbmRlciRwcm9wczMsIF90b3VjaFJlc3BvbmRlciRwcm9wczQ7XG5cbiAgaWYgKGlzVGV4dElucHV0KGVsZW1lbnQpKSByZXR1cm4gKGVsZW1lbnQgPT09IG51bGwgfHwgZWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWxlbWVudC5wcm9wcy5lZGl0YWJsZSkgIT09IGZhbHNlO1xuICBpZiAoIWlzUG9pbnRlckV2ZW50RW5hYmxlZChlbGVtZW50KSkgcmV0dXJuIGZhbHNlO1xuICBjb25zdCB0b3VjaFN0YXJ0ID0gdG91Y2hSZXNwb25kZXIgPT09IG51bGwgfHwgdG91Y2hSZXNwb25kZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdG91Y2hSZXNwb25kZXIkcHJvcHMgPSAoX3RvdWNoUmVzcG9uZGVyJHByb3BzMiA9IHRvdWNoUmVzcG9uZGVyLnByb3BzKS5vblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyKSA9PT0gbnVsbCB8fCBfdG91Y2hSZXNwb25kZXIkcHJvcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90b3VjaFJlc3BvbmRlciRwcm9wcy5jYWxsKF90b3VjaFJlc3BvbmRlciRwcm9wczIpO1xuICBjb25zdCB0b3VjaE1vdmUgPSB0b3VjaFJlc3BvbmRlciA9PT0gbnVsbCB8fCB0b3VjaFJlc3BvbmRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90b3VjaFJlc3BvbmRlciRwcm9wczMgPSAoX3RvdWNoUmVzcG9uZGVyJHByb3BzNCA9IHRvdWNoUmVzcG9uZGVyLnByb3BzKS5vbk1vdmVTaG91bGRTZXRSZXNwb25kZXIpID09PSBudWxsIHx8IF90b3VjaFJlc3BvbmRlciRwcm9wczMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90b3VjaFJlc3BvbmRlciRwcm9wczMuY2FsbChfdG91Y2hSZXNwb25kZXIkcHJvcHM0KTtcbiAgaWYgKHRvdWNoU3RhcnQgfHwgdG91Y2hNb3ZlKSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIHRvdWNoU3RhcnQgPT09IHVuZGVmaW5lZCAmJiB0b3VjaE1vdmUgPT09IHVuZGVmaW5lZDtcbn07XG5cbmNvbnN0IGZpbmRFdmVudEhhbmRsZXIgPSAoZWxlbWVudCwgZXZlbnROYW1lLCBjYWxsc2l0ZSwgbmVhcmVzdFRvdWNoUmVzcG9uZGVyKSA9PiB7XG4gIGNvbnN0IHRvdWNoUmVzcG9uZGVyID0gaXNUb3VjaFJlc3BvbmRlcihlbGVtZW50KSA/IGVsZW1lbnQgOiBuZWFyZXN0VG91Y2hSZXNwb25kZXI7XG4gIGNvbnN0IGhhbmRsZXIgPSBnZXRFdmVudEhhbmRsZXIoZWxlbWVudCwgZXZlbnROYW1lKTtcbiAgaWYgKGhhbmRsZXIgJiYgaXNFdmVudEVuYWJsZWQoZWxlbWVudCwgdG91Y2hSZXNwb25kZXIpKSByZXR1cm4gaGFuZGxlcjtcblxuICBpZiAoZWxlbWVudC5wYXJlbnQgPT09IG51bGwgfHwgZWxlbWVudC5wYXJlbnQucGFyZW50ID09PSBudWxsKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gZmluZEV2ZW50SGFuZGxlcihlbGVtZW50LnBhcmVudCwgZXZlbnROYW1lLCBjYWxsc2l0ZSwgdG91Y2hSZXNwb25kZXIpO1xufTtcblxuY29uc3QgZ2V0RXZlbnRIYW5kbGVyID0gKGVsZW1lbnQsIGV2ZW50TmFtZSkgPT4ge1xuICBjb25zdCBldmVudEhhbmRsZXJOYW1lID0gdG9FdmVudEhhbmRsZXJOYW1lKGV2ZW50TmFtZSk7XG5cbiAgaWYgKHR5cGVvZiBlbGVtZW50LnByb3BzW2V2ZW50SGFuZGxlck5hbWVdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQucHJvcHNbZXZlbnRIYW5kbGVyTmFtZV07XG4gIH1cblxuICBpZiAodHlwZW9mIGVsZW1lbnQucHJvcHNbZXZlbnROYW1lXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBlbGVtZW50LnByb3BzW2V2ZW50TmFtZV07XG4gIH1cblxuICByZXR1cm4gdW5kZWZpbmVkO1xufTtcblxuY29uc3QgaW52b2tlRXZlbnQgPSAoZWxlbWVudCwgZXZlbnROYW1lLCBjYWxsc2l0ZSwgLi4uZGF0YSkgPT4ge1xuICBjb25zdCBoYW5kbGVyID0gZmluZEV2ZW50SGFuZGxlcihlbGVtZW50LCBldmVudE5hbWUsIGNhbGxzaXRlKTtcblxuICBpZiAoIWhhbmRsZXIpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgcmV0dXJuVmFsdWU7XG4gICgwLCBfYWN0LmRlZmF1bHQpKCgpID0+IHtcbiAgICByZXR1cm5WYWx1ZSA9IGhhbmRsZXIoLi4uZGF0YSk7XG4gIH0pO1xuICByZXR1cm4gcmV0dXJuVmFsdWU7XG59O1xuXG5jb25zdCB0b0V2ZW50SGFuZGxlck5hbWUgPSBldmVudE5hbWUgPT4gYG9uJHtldmVudE5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCl9JHtldmVudE5hbWUuc2xpY2UoMSl9YDtcblxuY29uc3QgcHJlc3NIYW5kbGVyID0gKGVsZW1lbnQsIC4uLmRhdGEpID0+IGludm9rZUV2ZW50KGVsZW1lbnQsICdwcmVzcycsIHByZXNzSGFuZGxlciwgLi4uZGF0YSk7XG5cbmNvbnN0IGNoYW5nZVRleHRIYW5kbGVyID0gKGVsZW1lbnQsIC4uLmRhdGEpID0+IGludm9rZUV2ZW50KGVsZW1lbnQsICdjaGFuZ2VUZXh0JywgY2hhbmdlVGV4dEhhbmRsZXIsIC4uLmRhdGEpO1xuXG5jb25zdCBzY3JvbGxIYW5kbGVyID0gKGVsZW1lbnQsIC4uLmRhdGEpID0+IGludm9rZUV2ZW50KGVsZW1lbnQsICdzY3JvbGwnLCBzY3JvbGxIYW5kbGVyLCAuLi5kYXRhKTtcblxuY29uc3QgZmlyZUV2ZW50ID0gKGVsZW1lbnQsIGV2ZW50TmFtZSwgLi4uZGF0YSkgPT4gaW52b2tlRXZlbnQoZWxlbWVudCwgZXZlbnROYW1lLCBmaXJlRXZlbnQsIC4uLmRhdGEpO1xuXG5maXJlRXZlbnQucHJlc3MgPSBwcmVzc0hhbmRsZXI7XG5maXJlRXZlbnQuY2hhbmdlVGV4dCA9IGNoYW5nZVRleHRIYW5kbGVyO1xuZmlyZUV2ZW50LnNjcm9sbCA9IHNjcm9sbEhhbmRsZXI7XG52YXIgX2RlZmF1bHQgPSBmaXJlRXZlbnQ7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDsiXX0=