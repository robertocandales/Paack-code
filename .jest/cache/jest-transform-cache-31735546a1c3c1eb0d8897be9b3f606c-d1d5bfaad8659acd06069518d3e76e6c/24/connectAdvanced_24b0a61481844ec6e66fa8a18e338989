fa7403bcf6e036edad7459712dde2da7
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault")["default"];

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard")["default"];

exports.__esModule = true;
exports["default"] = connectAdvanced;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _hoistNonReactStatics = _interopRequireDefault(require("hoist-non-react-statics"));

var _react = _interopRequireWildcard(require("react"));

var _reactIs = require("react-is");

var _Subscription = require("../utils/Subscription");

var _useIsomorphicLayoutEffect = require("../utils/useIsomorphicLayoutEffect");

var _Context = require("./Context");

var _excluded = ["getDisplayName", "methodName", "renderCountProp", "shouldHandleStateChanges", "storeKey", "withRef", "forwardRef", "context"],
    _excluded2 = ["reactReduxForwardedRef"];
var EMPTY_ARRAY = [];
var NO_SUBSCRIPTION_ARRAY = [null, null];

var stringifyComponent = function stringifyComponent(Comp) {
  try {
    return JSON.stringify(Comp);
  } catch (err) {
    return String(Comp);
  }
};

function storeStateUpdatesReducer(state, action) {
  var updateCount = state[1];
  return [action.payload, updateCount + 1];
}

function useIsomorphicLayoutEffectWithArgs(effectFunc, effectArgs, dependencies) {
  (0, _useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function () {
    return effectFunc.apply(void 0, effectArgs);
  }, dependencies);
}

function captureWrapperProps(lastWrapperProps, lastChildProps, renderIsScheduled, wrapperProps, actualChildProps, childPropsFromStoreUpdate, notifyNestedSubs) {
  lastWrapperProps.current = wrapperProps;
  lastChildProps.current = actualChildProps;
  renderIsScheduled.current = false;

  if (childPropsFromStoreUpdate.current) {
    childPropsFromStoreUpdate.current = null;
    notifyNestedSubs();
  }
}

function subscribeUpdates(shouldHandleStateChanges, store, subscription, childPropsSelector, lastWrapperProps, lastChildProps, renderIsScheduled, childPropsFromStoreUpdate, notifyNestedSubs, forceComponentUpdateDispatch) {
  if (!shouldHandleStateChanges) return;
  var didUnsubscribe = false;
  var lastThrownError = null;

  var checkForUpdates = function checkForUpdates() {
    if (didUnsubscribe) {
      return;
    }

    var latestStoreState = store.getState();
    var newChildProps, error;

    try {
      newChildProps = childPropsSelector(latestStoreState, lastWrapperProps.current);
    } catch (e) {
      error = e;
      lastThrownError = e;
    }

    if (!error) {
      lastThrownError = null;
    }

    if (newChildProps === lastChildProps.current) {
      if (!renderIsScheduled.current) {
        notifyNestedSubs();
      }
    } else {
      lastChildProps.current = newChildProps;
      childPropsFromStoreUpdate.current = newChildProps;
      renderIsScheduled.current = true;
      forceComponentUpdateDispatch({
        type: 'STORE_UPDATED',
        payload: {
          error: error
        }
      });
    }
  };

  subscription.onStateChange = checkForUpdates;
  subscription.trySubscribe();
  checkForUpdates();

  var unsubscribeWrapper = function unsubscribeWrapper() {
    didUnsubscribe = true;
    subscription.tryUnsubscribe();
    subscription.onStateChange = null;

    if (lastThrownError) {
      throw lastThrownError;
    }
  };

  return unsubscribeWrapper;
}

var initStateUpdates = function initStateUpdates() {
  return [null, 0];
};

function connectAdvanced(selectorFactory, _ref) {
  if (_ref === void 0) {
    _ref = {};
  }

  var _ref2 = _ref,
      _ref2$getDisplayName = _ref2.getDisplayName,
      getDisplayName = _ref2$getDisplayName === void 0 ? function (name) {
    return "ConnectAdvanced(" + name + ")";
  } : _ref2$getDisplayName,
      _ref2$methodName = _ref2.methodName,
      methodName = _ref2$methodName === void 0 ? 'connectAdvanced' : _ref2$methodName,
      _ref2$renderCountProp = _ref2.renderCountProp,
      renderCountProp = _ref2$renderCountProp === void 0 ? undefined : _ref2$renderCountProp,
      _ref2$shouldHandleSta = _ref2.shouldHandleStateChanges,
      shouldHandleStateChanges = _ref2$shouldHandleSta === void 0 ? true : _ref2$shouldHandleSta,
      _ref2$storeKey = _ref2.storeKey,
      storeKey = _ref2$storeKey === void 0 ? 'store' : _ref2$storeKey,
      _ref2$withRef = _ref2.withRef,
      withRef = _ref2$withRef === void 0 ? false : _ref2$withRef,
      _ref2$forwardRef = _ref2.forwardRef,
      forwardRef = _ref2$forwardRef === void 0 ? false : _ref2$forwardRef,
      _ref2$context = _ref2.context,
      context = _ref2$context === void 0 ? _Context.ReactReduxContext : _ref2$context,
      connectOptions = (0, _objectWithoutPropertiesLoose2["default"])(_ref2, _excluded);

  if (process.env.NODE_ENV !== 'production') {
    if (renderCountProp !== undefined) {
      throw new Error("renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension");
    }

    if (withRef) {
      throw new Error('withRef is removed. To access the wrapped instance, use a ref on the connected component');
    }

    var customStoreWarningMessage = 'To use a custom Redux store for specific components, create a custom React context with ' + "React.createContext(), and pass the context object to React Redux's Provider and specific components" + ' like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. ' + 'You may also pass a {context : MyContext} option to connect';

    if (storeKey !== 'store') {
      throw new Error('storeKey has been removed and does not do anything. ' + customStoreWarningMessage);
    }
  }

  var Context = context;
  return function wrapWithConnect(WrappedComponent) {
    if (process.env.NODE_ENV !== 'production' && !(0, _reactIs.isValidElementType)(WrappedComponent)) {
      throw new Error("You must pass a component to the function returned by " + (methodName + ". Instead received " + stringifyComponent(WrappedComponent)));
    }

    var wrappedComponentName = WrappedComponent.displayName || WrappedComponent.name || 'Component';
    var displayName = getDisplayName(wrappedComponentName);
    var selectorFactoryOptions = (0, _extends2["default"])({}, connectOptions, {
      getDisplayName: getDisplayName,
      methodName: methodName,
      renderCountProp: renderCountProp,
      shouldHandleStateChanges: shouldHandleStateChanges,
      storeKey: storeKey,
      displayName: displayName,
      wrappedComponentName: wrappedComponentName,
      WrappedComponent: WrappedComponent
    });
    var pure = connectOptions.pure;

    function createChildSelector(store) {
      return selectorFactory(store.dispatch, selectorFactoryOptions);
    }

    var usePureOnlyMemo = pure ? _react.useMemo : function (callback) {
      return callback();
    };

    function ConnectFunction(props) {
      var _useMemo = (0, _react.useMemo)(function () {
        var reactReduxForwardedRef = props.reactReduxForwardedRef,
            wrapperProps = (0, _objectWithoutPropertiesLoose2["default"])(props, _excluded2);
        return [props.context, reactReduxForwardedRef, wrapperProps];
      }, [props]),
          propsContext = _useMemo[0],
          reactReduxForwardedRef = _useMemo[1],
          wrapperProps = _useMemo[2];

      var ContextToUse = (0, _react.useMemo)(function () {
        return propsContext && propsContext.Consumer && (0, _reactIs.isContextConsumer)(_react["default"].createElement(propsContext.Consumer, null)) ? propsContext : Context;
      }, [propsContext, Context]);
      var contextValue = (0, _react.useContext)(ContextToUse);
      var didStoreComeFromProps = Boolean(props.store) && Boolean(props.store.getState) && Boolean(props.store.dispatch);
      var didStoreComeFromContext = Boolean(contextValue) && Boolean(contextValue.store);

      if (process.env.NODE_ENV !== 'production' && !didStoreComeFromProps && !didStoreComeFromContext) {
        throw new Error("Could not find \"store\" in the context of " + ("\"" + displayName + "\". Either wrap the root component in a <Provider>, ") + "or pass a custom React context provider to <Provider> and the corresponding " + ("React context consumer to " + displayName + " in connect options."));
      }

      var store = didStoreComeFromProps ? props.store : contextValue.store;
      var childPropsSelector = (0, _react.useMemo)(function () {
        return createChildSelector(store);
      }, [store]);

      var _useMemo2 = (0, _react.useMemo)(function () {
        if (!shouldHandleStateChanges) return NO_SUBSCRIPTION_ARRAY;
        var subscription = (0, _Subscription.createSubscription)(store, didStoreComeFromProps ? null : contextValue.subscription);
        var notifyNestedSubs = subscription.notifyNestedSubs.bind(subscription);
        return [subscription, notifyNestedSubs];
      }, [store, didStoreComeFromProps, contextValue]),
          subscription = _useMemo2[0],
          notifyNestedSubs = _useMemo2[1];

      var overriddenContextValue = (0, _react.useMemo)(function () {
        if (didStoreComeFromProps) {
          return contextValue;
        }

        return (0, _extends2["default"])({}, contextValue, {
          subscription: subscription
        });
      }, [didStoreComeFromProps, contextValue, subscription]);

      var _useReducer = (0, _react.useReducer)(storeStateUpdatesReducer, EMPTY_ARRAY, initStateUpdates),
          _useReducer$ = _useReducer[0],
          previousStateUpdateResult = _useReducer$[0],
          forceComponentUpdateDispatch = _useReducer[1];

      if (previousStateUpdateResult && previousStateUpdateResult.error) {
        throw previousStateUpdateResult.error;
      }

      var lastChildProps = (0, _react.useRef)();
      var lastWrapperProps = (0, _react.useRef)(wrapperProps);
      var childPropsFromStoreUpdate = (0, _react.useRef)();
      var renderIsScheduled = (0, _react.useRef)(false);
      var actualChildProps = usePureOnlyMemo(function () {
        if (childPropsFromStoreUpdate.current && wrapperProps === lastWrapperProps.current) {
          return childPropsFromStoreUpdate.current;
        }

        return childPropsSelector(store.getState(), wrapperProps);
      }, [store, previousStateUpdateResult, wrapperProps]);
      useIsomorphicLayoutEffectWithArgs(captureWrapperProps, [lastWrapperProps, lastChildProps, renderIsScheduled, wrapperProps, actualChildProps, childPropsFromStoreUpdate, notifyNestedSubs]);
      useIsomorphicLayoutEffectWithArgs(subscribeUpdates, [shouldHandleStateChanges, store, subscription, childPropsSelector, lastWrapperProps, lastChildProps, renderIsScheduled, childPropsFromStoreUpdate, notifyNestedSubs, forceComponentUpdateDispatch], [store, subscription, childPropsSelector]);
      var renderedWrappedComponent = (0, _react.useMemo)(function () {
        return _react["default"].createElement(WrappedComponent, (0, _extends2["default"])({}, actualChildProps, {
          ref: reactReduxForwardedRef
        }));
      }, [reactReduxForwardedRef, WrappedComponent, actualChildProps]);
      var renderedChild = (0, _react.useMemo)(function () {
        if (shouldHandleStateChanges) {
          return _react["default"].createElement(ContextToUse.Provider, {
            value: overriddenContextValue
          }, renderedWrappedComponent);
        }

        return renderedWrappedComponent;
      }, [ContextToUse, renderedWrappedComponent, overriddenContextValue]);
      return renderedChild;
    }

    var Connect = pure ? _react["default"].memo(ConnectFunction) : ConnectFunction;
    Connect.WrappedComponent = WrappedComponent;
    Connect.displayName = ConnectFunction.displayName = displayName;

    if (forwardRef) {
      var forwarded = _react["default"].forwardRef(function forwardConnectRef(props, ref) {
        return _react["default"].createElement(Connect, (0, _extends2["default"])({}, props, {
          reactReduxForwardedRef: ref
        }));
      });

      forwarded.displayName = displayName;
      forwarded.WrappedComponent = WrappedComponent;
      return (0, _hoistNonReactStatics["default"])(forwarded, WrappedComponent);
    }

    return (0, _hoistNonReactStatics["default"])(Connect, WrappedComponent);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RBZHZhbmNlZC5qcyJdLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJjb25uZWN0QWR2YW5jZWQiLCJfZXh0ZW5kczIiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTIiLCJfaG9pc3ROb25SZWFjdFN0YXRpY3MiLCJfcmVhY3QiLCJfcmVhY3RJcyIsIl9TdWJzY3JpcHRpb24iLCJfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCIsIl9Db250ZXh0IiwiX2V4Y2x1ZGVkIiwiX2V4Y2x1ZGVkMiIsIkVNUFRZX0FSUkFZIiwiTk9fU1VCU0NSSVBUSU9OX0FSUkFZIiwic3RyaW5naWZ5Q29tcG9uZW50IiwiQ29tcCIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJTdHJpbmciLCJzdG9yZVN0YXRlVXBkYXRlc1JlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInVwZGF0ZUNvdW50IiwicGF5bG9hZCIsInVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3RXaXRoQXJncyIsImVmZmVjdEZ1bmMiLCJlZmZlY3RBcmdzIiwiZGVwZW5kZW5jaWVzIiwidXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCIsImFwcGx5IiwiY2FwdHVyZVdyYXBwZXJQcm9wcyIsImxhc3RXcmFwcGVyUHJvcHMiLCJsYXN0Q2hpbGRQcm9wcyIsInJlbmRlcklzU2NoZWR1bGVkIiwid3JhcHBlclByb3BzIiwiYWN0dWFsQ2hpbGRQcm9wcyIsImNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUiLCJub3RpZnlOZXN0ZWRTdWJzIiwiY3VycmVudCIsInN1YnNjcmliZVVwZGF0ZXMiLCJzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMiLCJzdG9yZSIsInN1YnNjcmlwdGlvbiIsImNoaWxkUHJvcHNTZWxlY3RvciIsImZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2giLCJkaWRVbnN1YnNjcmliZSIsImxhc3RUaHJvd25FcnJvciIsImNoZWNrRm9yVXBkYXRlcyIsImxhdGVzdFN0b3JlU3RhdGUiLCJnZXRTdGF0ZSIsIm5ld0NoaWxkUHJvcHMiLCJlcnJvciIsImUiLCJ0eXBlIiwib25TdGF0ZUNoYW5nZSIsInRyeVN1YnNjcmliZSIsInVuc3Vic2NyaWJlV3JhcHBlciIsInRyeVVuc3Vic2NyaWJlIiwiaW5pdFN0YXRlVXBkYXRlcyIsInNlbGVjdG9yRmFjdG9yeSIsIl9yZWYiLCJfcmVmMiIsIl9yZWYyJGdldERpc3BsYXlOYW1lIiwiZ2V0RGlzcGxheU5hbWUiLCJuYW1lIiwiX3JlZjIkbWV0aG9kTmFtZSIsIm1ldGhvZE5hbWUiLCJfcmVmMiRyZW5kZXJDb3VudFByb3AiLCJyZW5kZXJDb3VudFByb3AiLCJ1bmRlZmluZWQiLCJfcmVmMiRzaG91bGRIYW5kbGVTdGEiLCJfcmVmMiRzdG9yZUtleSIsInN0b3JlS2V5IiwiX3JlZjIkd2l0aFJlZiIsIndpdGhSZWYiLCJfcmVmMiRmb3J3YXJkUmVmIiwiZm9yd2FyZFJlZiIsIl9yZWYyJGNvbnRleHQiLCJjb250ZXh0IiwiUmVhY3RSZWR1eENvbnRleHQiLCJjb25uZWN0T3B0aW9ucyIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIkVycm9yIiwiY3VzdG9tU3RvcmVXYXJuaW5nTWVzc2FnZSIsIkNvbnRleHQiLCJ3cmFwV2l0aENvbm5lY3QiLCJXcmFwcGVkQ29tcG9uZW50IiwiaXNWYWxpZEVsZW1lbnRUeXBlIiwid3JhcHBlZENvbXBvbmVudE5hbWUiLCJkaXNwbGF5TmFtZSIsInNlbGVjdG9yRmFjdG9yeU9wdGlvbnMiLCJwdXJlIiwiY3JlYXRlQ2hpbGRTZWxlY3RvciIsImRpc3BhdGNoIiwidXNlUHVyZU9ubHlNZW1vIiwidXNlTWVtbyIsImNhbGxiYWNrIiwiQ29ubmVjdEZ1bmN0aW9uIiwicHJvcHMiLCJfdXNlTWVtbyIsInJlYWN0UmVkdXhGb3J3YXJkZWRSZWYiLCJwcm9wc0NvbnRleHQiLCJDb250ZXh0VG9Vc2UiLCJDb25zdW1lciIsImlzQ29udGV4dENvbnN1bWVyIiwiY3JlYXRlRWxlbWVudCIsImNvbnRleHRWYWx1ZSIsInVzZUNvbnRleHQiLCJkaWRTdG9yZUNvbWVGcm9tUHJvcHMiLCJCb29sZWFuIiwiZGlkU3RvcmVDb21lRnJvbUNvbnRleHQiLCJfdXNlTWVtbzIiLCJjcmVhdGVTdWJzY3JpcHRpb24iLCJiaW5kIiwib3ZlcnJpZGRlbkNvbnRleHRWYWx1ZSIsIl91c2VSZWR1Y2VyIiwidXNlUmVkdWNlciIsIl91c2VSZWR1Y2VyJCIsInByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQiLCJ1c2VSZWYiLCJyZW5kZXJlZFdyYXBwZWRDb21wb25lbnQiLCJyZWYiLCJyZW5kZXJlZENoaWxkIiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIkNvbm5lY3QiLCJtZW1vIiwiZm9yd2FyZGVkIiwiZm9yd2FyZENvbm5lY3RSZWYiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLHNCQUFzQixHQUFHQyxPQUFPLENBQUMsOENBQUQsQ0FBUCxDQUF3RCxTQUF4RCxDQUE3Qjs7QUFFQSxJQUFJQyx1QkFBdUIsR0FBR0QsT0FBTyxDQUFDLCtDQUFELENBQVAsQ0FBeUQsU0FBekQsQ0FBOUI7O0FBRUFFLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUMsU0FBRCxDQUFQLEdBQXFCRSxlQUFyQjs7QUFFQSxJQUFJQyxTQUFTLEdBQUdOLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsZ0NBQUQsQ0FBUixDQUF0Qzs7QUFFQSxJQUFJTSw4QkFBOEIsR0FBR1Asc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxxREFBRCxDQUFSLENBQTNEOztBQUVBLElBQUlPLHFCQUFxQixHQUFHUixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLHlCQUFELENBQVIsQ0FBbEQ7O0FBRUEsSUFBSVEsTUFBTSxHQUFHUCx1QkFBdUIsQ0FBQ0QsT0FBTyxDQUFDLE9BQUQsQ0FBUixDQUFwQzs7QUFFQSxJQUFJUyxRQUFRLEdBQUdULE9BQU8sQ0FBQyxVQUFELENBQXRCOztBQUVBLElBQUlVLGFBQWEsR0FBR1YsT0FBTyx5QkFBM0I7O0FBRUEsSUFBSVcsMEJBQTBCLEdBQUdYLE9BQU8sc0NBQXhDOztBQUVBLElBQUlZLFFBQVEsR0FBR1osT0FBTyxhQUF0Qjs7QUFFQSxJQUFJYSxTQUFTLEdBQUcsQ0FBQyxnQkFBRCxFQUFtQixZQUFuQixFQUFpQyxpQkFBakMsRUFBb0QsMEJBQXBELEVBQWdGLFVBQWhGLEVBQTRGLFNBQTVGLEVBQXVHLFlBQXZHLEVBQXFILFNBQXJILENBQWhCO0FBQUEsSUFDSUMsVUFBVSxHQUFHLENBQUMsd0JBQUQsQ0FEakI7QUFHQSxJQUFJQyxXQUFXLEdBQUcsRUFBbEI7QUFDQSxJQUFJQyxxQkFBcUIsR0FBRyxDQUFDLElBQUQsRUFBTyxJQUFQLENBQTVCOztBQUVBLElBQUlDLGtCQUFrQixHQUFHLFNBQVNBLGtCQUFULENBQTRCQyxJQUE1QixFQUFrQztBQUN6RCxNQUFJO0FBQ0YsV0FBT0MsSUFBSSxDQUFDQyxTQUFMLENBQWVGLElBQWYsQ0FBUDtBQUNELEdBRkQsQ0FFRSxPQUFPRyxHQUFQLEVBQVk7QUFDWixXQUFPQyxNQUFNLENBQUNKLElBQUQsQ0FBYjtBQUNEO0FBQ0YsQ0FORDs7QUFRQSxTQUFTSyx3QkFBVCxDQUFrQ0MsS0FBbEMsRUFBeUNDLE1BQXpDLEVBQWlEO0FBQy9DLE1BQUlDLFdBQVcsR0FBR0YsS0FBSyxDQUFDLENBQUQsQ0FBdkI7QUFDQSxTQUFPLENBQUNDLE1BQU0sQ0FBQ0UsT0FBUixFQUFpQkQsV0FBVyxHQUFHLENBQS9CLENBQVA7QUFDRDs7QUFFRCxTQUFTRSxpQ0FBVCxDQUEyQ0MsVUFBM0MsRUFBdURDLFVBQXZELEVBQW1FQyxZQUFuRSxFQUFpRjtBQUMvRSxHQUFDLEdBQUdwQiwwQkFBMEIsQ0FBQ3FCLHlCQUEvQixFQUEwRCxZQUFZO0FBQ3BFLFdBQU9ILFVBQVUsQ0FBQ0ksS0FBWCxDQUFpQixLQUFLLENBQXRCLEVBQXlCSCxVQUF6QixDQUFQO0FBQ0QsR0FGRCxFQUVHQyxZQUZIO0FBR0Q7O0FBRUQsU0FBU0csbUJBQVQsQ0FBNkJDLGdCQUE3QixFQUErQ0MsY0FBL0MsRUFBK0RDLGlCQUEvRCxFQUFrRkMsWUFBbEYsRUFBZ0dDLGdCQUFoRyxFQUFrSEMseUJBQWxILEVBQTZJQyxnQkFBN0ksRUFBK0o7QUFFN0pOLEVBQUFBLGdCQUFnQixDQUFDTyxPQUFqQixHQUEyQkosWUFBM0I7QUFDQUYsRUFBQUEsY0FBYyxDQUFDTSxPQUFmLEdBQXlCSCxnQkFBekI7QUFDQUYsRUFBQUEsaUJBQWlCLENBQUNLLE9BQWxCLEdBQTRCLEtBQTVCOztBQUVBLE1BQUlGLHlCQUF5QixDQUFDRSxPQUE5QixFQUF1QztBQUNyQ0YsSUFBQUEseUJBQXlCLENBQUNFLE9BQTFCLEdBQW9DLElBQXBDO0FBQ0FELElBQUFBLGdCQUFnQjtBQUNqQjtBQUNGOztBQUVELFNBQVNFLGdCQUFULENBQTBCQyx3QkFBMUIsRUFBb0RDLEtBQXBELEVBQTJEQyxZQUEzRCxFQUF5RUMsa0JBQXpFLEVBQTZGWixnQkFBN0YsRUFBK0dDLGNBQS9HLEVBQStIQyxpQkFBL0gsRUFBa0pHLHlCQUFsSixFQUE2S0MsZ0JBQTdLLEVBQStMTyw0QkFBL0wsRUFBNk47QUFFM04sTUFBSSxDQUFDSix3QkFBTCxFQUErQjtBQUUvQixNQUFJSyxjQUFjLEdBQUcsS0FBckI7QUFDQSxNQUFJQyxlQUFlLEdBQUcsSUFBdEI7O0FBRUEsTUFBSUMsZUFBZSxHQUFHLFNBQVNBLGVBQVQsR0FBMkI7QUFDL0MsUUFBSUYsY0FBSixFQUFvQjtBQUdsQjtBQUNEOztBQUVELFFBQUlHLGdCQUFnQixHQUFHUCxLQUFLLENBQUNRLFFBQU4sRUFBdkI7QUFDQSxRQUFJQyxhQUFKLEVBQW1CQyxLQUFuQjs7QUFFQSxRQUFJO0FBR0ZELE1BQUFBLGFBQWEsR0FBR1Asa0JBQWtCLENBQUNLLGdCQUFELEVBQW1CakIsZ0JBQWdCLENBQUNPLE9BQXBDLENBQWxDO0FBQ0QsS0FKRCxDQUlFLE9BQU9jLENBQVAsRUFBVTtBQUNWRCxNQUFBQSxLQUFLLEdBQUdDLENBQVI7QUFDQU4sTUFBQUEsZUFBZSxHQUFHTSxDQUFsQjtBQUNEOztBQUVELFFBQUksQ0FBQ0QsS0FBTCxFQUFZO0FBQ1ZMLE1BQUFBLGVBQWUsR0FBRyxJQUFsQjtBQUNEOztBQUdELFFBQUlJLGFBQWEsS0FBS2xCLGNBQWMsQ0FBQ00sT0FBckMsRUFBOEM7QUFDNUMsVUFBSSxDQUFDTCxpQkFBaUIsQ0FBQ0ssT0FBdkIsRUFBZ0M7QUFDOUJELFFBQUFBLGdCQUFnQjtBQUNqQjtBQUNGLEtBSkQsTUFJTztBQUtMTCxNQUFBQSxjQUFjLENBQUNNLE9BQWYsR0FBeUJZLGFBQXpCO0FBQ0FkLE1BQUFBLHlCQUF5QixDQUFDRSxPQUExQixHQUFvQ1ksYUFBcEM7QUFDQWpCLE1BQUFBLGlCQUFpQixDQUFDSyxPQUFsQixHQUE0QixJQUE1QjtBQUVBTSxNQUFBQSw0QkFBNEIsQ0FBQztBQUMzQlMsUUFBQUEsSUFBSSxFQUFFLGVBRHFCO0FBRTNCOUIsUUFBQUEsT0FBTyxFQUFFO0FBQ1A0QixVQUFBQSxLQUFLLEVBQUVBO0FBREE7QUFGa0IsT0FBRCxDQUE1QjtBQU1EO0FBQ0YsR0E1Q0Q7O0FBK0NBVCxFQUFBQSxZQUFZLENBQUNZLGFBQWIsR0FBNkJQLGVBQTdCO0FBQ0FMLEVBQUFBLFlBQVksQ0FBQ2EsWUFBYjtBQUdBUixFQUFBQSxlQUFlOztBQUVmLE1BQUlTLGtCQUFrQixHQUFHLFNBQVNBLGtCQUFULEdBQThCO0FBQ3JEWCxJQUFBQSxjQUFjLEdBQUcsSUFBakI7QUFDQUgsSUFBQUEsWUFBWSxDQUFDZSxjQUFiO0FBQ0FmLElBQUFBLFlBQVksQ0FBQ1ksYUFBYixHQUE2QixJQUE3Qjs7QUFFQSxRQUFJUixlQUFKLEVBQXFCO0FBTW5CLFlBQU1BLGVBQU47QUFDRDtBQUNGLEdBYkQ7O0FBZUEsU0FBT1Usa0JBQVA7QUFDRDs7QUFFRCxJQUFJRSxnQkFBZ0IsR0FBRyxTQUFTQSxnQkFBVCxHQUE0QjtBQUNqRCxTQUFPLENBQUMsSUFBRCxFQUFPLENBQVAsQ0FBUDtBQUNELENBRkQ7O0FBSUEsU0FBUzFELGVBQVQsQ0FlQTJELGVBZkEsRUFnQkFDLElBaEJBLEVBZ0JNO0FBQ0osTUFBSUEsSUFBSSxLQUFLLEtBQUssQ0FBbEIsRUFBcUI7QUFDbkJBLElBQUFBLElBQUksR0FBRyxFQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsS0FBSyxHQUFHRCxJQUFaO0FBQUEsTUFDSUUsb0JBQW9CLEdBQUdELEtBQUssQ0FBQ0UsY0FEakM7QUFBQSxNQUVJQSxjQUFjLEdBQUdELG9CQUFvQixLQUFLLEtBQUssQ0FBOUIsR0FBa0MsVUFBVUUsSUFBVixFQUFnQjtBQUNyRSxXQUFPLHFCQUFxQkEsSUFBckIsR0FBNEIsR0FBbkM7QUFDRCxHQUZvQixHQUVqQkYsb0JBSko7QUFBQSxNQUtJRyxnQkFBZ0IsR0FBR0osS0FBSyxDQUFDSyxVQUw3QjtBQUFBLE1BTUlBLFVBQVUsR0FBR0QsZ0JBQWdCLEtBQUssS0FBSyxDQUExQixHQUE4QixpQkFBOUIsR0FBa0RBLGdCQU5uRTtBQUFBLE1BT0lFLHFCQUFxQixHQUFHTixLQUFLLENBQUNPLGVBUGxDO0FBQUEsTUFRSUEsZUFBZSxHQUFHRCxxQkFBcUIsS0FBSyxLQUFLLENBQS9CLEdBQW1DRSxTQUFuQyxHQUErQ0YscUJBUnJFO0FBQUEsTUFTSUcscUJBQXFCLEdBQUdULEtBQUssQ0FBQ3JCLHdCQVRsQztBQUFBLE1BVUlBLHdCQUF3QixHQUFHOEIscUJBQXFCLEtBQUssS0FBSyxDQUEvQixHQUFtQyxJQUFuQyxHQUEwQ0EscUJBVnpFO0FBQUEsTUFXSUMsY0FBYyxHQUFHVixLQUFLLENBQUNXLFFBWDNCO0FBQUEsTUFZSUEsUUFBUSxHQUFHRCxjQUFjLEtBQUssS0FBSyxDQUF4QixHQUE0QixPQUE1QixHQUFzQ0EsY0FackQ7QUFBQSxNQWFJRSxhQUFhLEdBQUdaLEtBQUssQ0FBQ2EsT0FiMUI7QUFBQSxNQWNJQSxPQUFPLEdBQUdELGFBQWEsS0FBSyxLQUFLLENBQXZCLEdBQTJCLEtBQTNCLEdBQW1DQSxhQWRqRDtBQUFBLE1BZUlFLGdCQUFnQixHQUFHZCxLQUFLLENBQUNlLFVBZjdCO0FBQUEsTUFnQklBLFVBQVUsR0FBR0QsZ0JBQWdCLEtBQUssS0FBSyxDQUExQixHQUE4QixLQUE5QixHQUFzQ0EsZ0JBaEJ2RDtBQUFBLE1BaUJJRSxhQUFhLEdBQUdoQixLQUFLLENBQUNpQixPQWpCMUI7QUFBQSxNQWtCSUEsT0FBTyxHQUFHRCxhQUFhLEtBQUssS0FBSyxDQUF2QixHQUEyQnJFLFFBQVEsQ0FBQ3VFLGlCQUFwQyxHQUF3REYsYUFsQnRFO0FBQUEsTUFtQklHLGNBQWMsR0FBRyxDQUFDLEdBQUc5RSw4QkFBOEIsQ0FBQyxTQUFELENBQWxDLEVBQStDMkQsS0FBL0MsRUFBc0RwRCxTQUF0RCxDQW5CckI7O0FBcUJBLE1BQUl3RSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUE3QixFQUEyQztBQUN6QyxRQUFJZixlQUFlLEtBQUtDLFNBQXhCLEVBQW1DO0FBQ2pDLFlBQU0sSUFBSWUsS0FBSixDQUFVLDBHQUFWLENBQU47QUFDRDs7QUFFRCxRQUFJVixPQUFKLEVBQWE7QUFDWCxZQUFNLElBQUlVLEtBQUosQ0FBVSwwRkFBVixDQUFOO0FBQ0Q7O0FBRUQsUUFBSUMseUJBQXlCLEdBQUcsNkZBQTZGLHNHQUE3RixHQUFzTSw4RkFBdE0sR0FBdVMsNkRBQXZVOztBQUVBLFFBQUliLFFBQVEsS0FBSyxPQUFqQixFQUEwQjtBQUN4QixZQUFNLElBQUlZLEtBQUosQ0FBVSx5REFBeURDLHlCQUFuRSxDQUFOO0FBQ0Q7QUFDRjs7QUFFRCxNQUFJQyxPQUFPLEdBQUdSLE9BQWQ7QUFDQSxTQUFPLFNBQVNTLGVBQVQsQ0FBeUJDLGdCQUF6QixFQUEyQztBQUNoRCxRQUFJUCxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUF6QixJQUF5QyxDQUFDLENBQUMsR0FBRzlFLFFBQVEsQ0FBQ29GLGtCQUFiLEVBQWlDRCxnQkFBakMsQ0FBOUMsRUFBa0c7QUFDaEcsWUFBTSxJQUFJSixLQUFKLENBQVUsNERBQTREbEIsVUFBVSxHQUFHLHFCQUFiLEdBQXFDckQsa0JBQWtCLENBQUMyRSxnQkFBRCxDQUFuSCxDQUFWLENBQU47QUFDRDs7QUFFRCxRQUFJRSxvQkFBb0IsR0FBR0YsZ0JBQWdCLENBQUNHLFdBQWpCLElBQWdDSCxnQkFBZ0IsQ0FBQ3hCLElBQWpELElBQXlELFdBQXBGO0FBQ0EsUUFBSTJCLFdBQVcsR0FBRzVCLGNBQWMsQ0FBQzJCLG9CQUFELENBQWhDO0FBQ0EsUUFBSUUsc0JBQXNCLEdBQUcsQ0FBQyxHQUFHM0YsU0FBUyxDQUFDLFNBQUQsQ0FBYixFQUEwQixFQUExQixFQUE4QitFLGNBQTlCLEVBQThDO0FBQ3pFakIsTUFBQUEsY0FBYyxFQUFFQSxjQUR5RDtBQUV6RUcsTUFBQUEsVUFBVSxFQUFFQSxVQUY2RDtBQUd6RUUsTUFBQUEsZUFBZSxFQUFFQSxlQUh3RDtBQUl6RTVCLE1BQUFBLHdCQUF3QixFQUFFQSx3QkFKK0M7QUFLekVnQyxNQUFBQSxRQUFRLEVBQUVBLFFBTCtEO0FBTXpFbUIsTUFBQUEsV0FBVyxFQUFFQSxXQU40RDtBQU96RUQsTUFBQUEsb0JBQW9CLEVBQUVBLG9CQVBtRDtBQVF6RUYsTUFBQUEsZ0JBQWdCLEVBQUVBO0FBUnVELEtBQTlDLENBQTdCO0FBVUEsUUFBSUssSUFBSSxHQUFHYixjQUFjLENBQUNhLElBQTFCOztBQUVBLGFBQVNDLG1CQUFULENBQTZCckQsS0FBN0IsRUFBb0M7QUFDbEMsYUFBT2tCLGVBQWUsQ0FBQ2xCLEtBQUssQ0FBQ3NELFFBQVAsRUFBaUJILHNCQUFqQixDQUF0QjtBQUNEOztBQUtELFFBQUlJLGVBQWUsR0FBR0gsSUFBSSxHQUFHekYsTUFBTSxDQUFDNkYsT0FBVixHQUFvQixVQUFVQyxRQUFWLEVBQW9CO0FBQ2hFLGFBQU9BLFFBQVEsRUFBZjtBQUNELEtBRkQ7O0FBSUEsYUFBU0MsZUFBVCxDQUF5QkMsS0FBekIsRUFBZ0M7QUFDOUIsVUFBSUMsUUFBUSxHQUFHLENBQUMsR0FBR2pHLE1BQU0sQ0FBQzZGLE9BQVgsRUFBb0IsWUFBWTtBQUk3QyxZQUFJSyxzQkFBc0IsR0FBR0YsS0FBSyxDQUFDRSxzQkFBbkM7QUFBQSxZQUNJcEUsWUFBWSxHQUFHLENBQUMsR0FBR2hDLDhCQUE4QixDQUFDLFNBQUQsQ0FBbEMsRUFBK0NrRyxLQUEvQyxFQUFzRDFGLFVBQXRELENBRG5CO0FBRUEsZUFBTyxDQUFDMEYsS0FBSyxDQUFDdEIsT0FBUCxFQUFnQndCLHNCQUFoQixFQUF3Q3BFLFlBQXhDLENBQVA7QUFDRCxPQVBjLEVBT1osQ0FBQ2tFLEtBQUQsQ0FQWSxDQUFmO0FBQUEsVUFRSUcsWUFBWSxHQUFHRixRQUFRLENBQUMsQ0FBRCxDQVIzQjtBQUFBLFVBU0lDLHNCQUFzQixHQUFHRCxRQUFRLENBQUMsQ0FBRCxDQVRyQztBQUFBLFVBVUluRSxZQUFZLEdBQUdtRSxRQUFRLENBQUMsQ0FBRCxDQVYzQjs7QUFZQSxVQUFJRyxZQUFZLEdBQUcsQ0FBQyxHQUFHcEcsTUFBTSxDQUFDNkYsT0FBWCxFQUFvQixZQUFZO0FBR2pELGVBQU9NLFlBQVksSUFBSUEsWUFBWSxDQUFDRSxRQUE3QixJQUF5QyxDQUFDLEdBQUdwRyxRQUFRLENBQUNxRyxpQkFBYixFQUE4Q3RHLE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0J1RyxhQUFsQixDQUFnQ0osWUFBWSxDQUFDRSxRQUE3QyxFQUF1RCxJQUF2RCxDQUE5QyxDQUF6QyxHQUF1SkYsWUFBdkosR0FBc0tqQixPQUE3SztBQUNELE9BSmtCLEVBSWhCLENBQUNpQixZQUFELEVBQWVqQixPQUFmLENBSmdCLENBQW5CO0FBTUEsVUFBSXNCLFlBQVksR0FBRyxDQUFDLEdBQUd4RyxNQUFNLENBQUN5RyxVQUFYLEVBQXVCTCxZQUF2QixDQUFuQjtBQUlBLFVBQUlNLHFCQUFxQixHQUFHQyxPQUFPLENBQUNYLEtBQUssQ0FBQzNELEtBQVAsQ0FBUCxJQUF3QnNFLE9BQU8sQ0FBQ1gsS0FBSyxDQUFDM0QsS0FBTixDQUFZUSxRQUFiLENBQS9CLElBQXlEOEQsT0FBTyxDQUFDWCxLQUFLLENBQUMzRCxLQUFOLENBQVlzRCxRQUFiLENBQTVGO0FBQ0EsVUFBSWlCLHVCQUF1QixHQUFHRCxPQUFPLENBQUNILFlBQUQsQ0FBUCxJQUF5QkcsT0FBTyxDQUFDSCxZQUFZLENBQUNuRSxLQUFkLENBQTlEOztBQUVBLFVBQUl3QyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUF6QixJQUF5QyxDQUFDMkIscUJBQTFDLElBQW1FLENBQUNFLHVCQUF4RSxFQUFpRztBQUMvRixjQUFNLElBQUk1QixLQUFKLENBQVUsaURBQWlELE9BQU9PLFdBQVAsR0FBcUIsc0RBQXRFLElBQWdJLDhFQUFoSSxJQUFrTiwrQkFBK0JBLFdBQS9CLEdBQTZDLHNCQUEvUCxDQUFWLENBQU47QUFDRDs7QUFHRCxVQUFJbEQsS0FBSyxHQUFHcUUscUJBQXFCLEdBQUdWLEtBQUssQ0FBQzNELEtBQVQsR0FBaUJtRSxZQUFZLENBQUNuRSxLQUEvRDtBQUNBLFVBQUlFLGtCQUFrQixHQUFHLENBQUMsR0FBR3ZDLE1BQU0sQ0FBQzZGLE9BQVgsRUFBb0IsWUFBWTtBQUd2RCxlQUFPSCxtQkFBbUIsQ0FBQ3JELEtBQUQsQ0FBMUI7QUFDRCxPQUp3QixFQUl0QixDQUFDQSxLQUFELENBSnNCLENBQXpCOztBQU1BLFVBQUl3RSxTQUFTLEdBQUcsQ0FBQyxHQUFHN0csTUFBTSxDQUFDNkYsT0FBWCxFQUFvQixZQUFZO0FBQzlDLFlBQUksQ0FBQ3pELHdCQUFMLEVBQStCLE9BQU81QixxQkFBUDtBQUsvQixZQUFJOEIsWUFBWSxHQUFHLENBQUMsR0FBR3BDLGFBQWEsQ0FBQzRHLGtCQUFsQixFQUFzQ3pFLEtBQXRDLEVBQTZDcUUscUJBQXFCLEdBQUcsSUFBSCxHQUFVRixZQUFZLENBQUNsRSxZQUF6RixDQUFuQjtBQVNBLFlBQUlMLGdCQUFnQixHQUFHSyxZQUFZLENBQUNMLGdCQUFiLENBQThCOEUsSUFBOUIsQ0FBbUN6RSxZQUFuQyxDQUF2QjtBQUNBLGVBQU8sQ0FBQ0EsWUFBRCxFQUFlTCxnQkFBZixDQUFQO0FBQ0QsT0FqQmUsRUFpQmIsQ0FBQ0ksS0FBRCxFQUFRcUUscUJBQVIsRUFBK0JGLFlBQS9CLENBakJhLENBQWhCO0FBQUEsVUFrQklsRSxZQUFZLEdBQUd1RSxTQUFTLENBQUMsQ0FBRCxDQWxCNUI7QUFBQSxVQW1CSTVFLGdCQUFnQixHQUFHNEUsU0FBUyxDQUFDLENBQUQsQ0FuQmhDOztBQXVCQSxVQUFJRyxzQkFBc0IsR0FBRyxDQUFDLEdBQUdoSCxNQUFNLENBQUM2RixPQUFYLEVBQW9CLFlBQVk7QUFDM0QsWUFBSWEscUJBQUosRUFBMkI7QUFJekIsaUJBQU9GLFlBQVA7QUFDRDs7QUFJRCxlQUFPLENBQUMsR0FBRzNHLFNBQVMsQ0FBQyxTQUFELENBQWIsRUFBMEIsRUFBMUIsRUFBOEIyRyxZQUE5QixFQUE0QztBQUNqRGxFLFVBQUFBLFlBQVksRUFBRUE7QUFEbUMsU0FBNUMsQ0FBUDtBQUdELE9BYjRCLEVBYTFCLENBQUNvRSxxQkFBRCxFQUF3QkYsWUFBeEIsRUFBc0NsRSxZQUF0QyxDQWIwQixDQUE3Qjs7QUFnQkEsVUFBSTJFLFdBQVcsR0FBRyxDQUFDLEdBQUdqSCxNQUFNLENBQUNrSCxVQUFYLEVBQXVCbkcsd0JBQXZCLEVBQWlEUixXQUFqRCxFQUE4RCtDLGdCQUE5RCxDQUFsQjtBQUFBLFVBQ0k2RCxZQUFZLEdBQUdGLFdBQVcsQ0FBQyxDQUFELENBRDlCO0FBQUEsVUFFSUcseUJBQXlCLEdBQUdELFlBQVksQ0FBQyxDQUFELENBRjVDO0FBQUEsVUFHSTNFLDRCQUE0QixHQUFHeUUsV0FBVyxDQUFDLENBQUQsQ0FIOUM7O0FBTUEsVUFBSUcseUJBQXlCLElBQUlBLHlCQUF5QixDQUFDckUsS0FBM0QsRUFBa0U7QUFDaEUsY0FBTXFFLHlCQUF5QixDQUFDckUsS0FBaEM7QUFDRDs7QUFHRCxVQUFJbkIsY0FBYyxHQUFHLENBQUMsR0FBRzVCLE1BQU0sQ0FBQ3FILE1BQVgsR0FBckI7QUFDQSxVQUFJMUYsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHM0IsTUFBTSxDQUFDcUgsTUFBWCxFQUFtQnZGLFlBQW5CLENBQXZCO0FBQ0EsVUFBSUUseUJBQXlCLEdBQUcsQ0FBQyxHQUFHaEMsTUFBTSxDQUFDcUgsTUFBWCxHQUFoQztBQUNBLFVBQUl4RixpQkFBaUIsR0FBRyxDQUFDLEdBQUc3QixNQUFNLENBQUNxSCxNQUFYLEVBQW1CLEtBQW5CLENBQXhCO0FBQ0EsVUFBSXRGLGdCQUFnQixHQUFHNkQsZUFBZSxDQUFDLFlBQVk7QUFPakQsWUFBSTVELHlCQUF5QixDQUFDRSxPQUExQixJQUFxQ0osWUFBWSxLQUFLSCxnQkFBZ0IsQ0FBQ08sT0FBM0UsRUFBb0Y7QUFDbEYsaUJBQU9GLHlCQUF5QixDQUFDRSxPQUFqQztBQUNEOztBQU1ELGVBQU9LLGtCQUFrQixDQUFDRixLQUFLLENBQUNRLFFBQU4sRUFBRCxFQUFtQmYsWUFBbkIsQ0FBekI7QUFDRCxPQWhCcUMsRUFnQm5DLENBQUNPLEtBQUQsRUFBUStFLHlCQUFSLEVBQW1DdEYsWUFBbkMsQ0FoQm1DLENBQXRDO0FBb0JBVixNQUFBQSxpQ0FBaUMsQ0FBQ00sbUJBQUQsRUFBc0IsQ0FBQ0MsZ0JBQUQsRUFBbUJDLGNBQW5CLEVBQW1DQyxpQkFBbkMsRUFBc0RDLFlBQXRELEVBQW9FQyxnQkFBcEUsRUFBc0ZDLHlCQUF0RixFQUFpSEMsZ0JBQWpILENBQXRCLENBQWpDO0FBRUFiLE1BQUFBLGlDQUFpQyxDQUFDZSxnQkFBRCxFQUFtQixDQUFDQyx3QkFBRCxFQUEyQkMsS0FBM0IsRUFBa0NDLFlBQWxDLEVBQWdEQyxrQkFBaEQsRUFBb0VaLGdCQUFwRSxFQUFzRkMsY0FBdEYsRUFBc0dDLGlCQUF0RyxFQUF5SEcseUJBQXpILEVBQW9KQyxnQkFBcEosRUFBc0tPLDRCQUF0SyxDQUFuQixFQUF3TixDQUFDSCxLQUFELEVBQVFDLFlBQVIsRUFBc0JDLGtCQUF0QixDQUF4TixDQUFqQztBQUdBLFVBQUkrRSx3QkFBd0IsR0FBRyxDQUFDLEdBQUd0SCxNQUFNLENBQUM2RixPQUFYLEVBQW9CLFlBQVk7QUFDN0QsZUFBb0I3RixNQUFNLENBQUMsU0FBRCxDQUFOLENBQWtCdUcsYUFBbEIsQ0FBZ0NuQixnQkFBaEMsRUFBa0QsQ0FBQyxHQUFHdkYsU0FBUyxDQUFDLFNBQUQsQ0FBYixFQUEwQixFQUExQixFQUE4QmtDLGdCQUE5QixFQUFnRDtBQUNwSHdGLFVBQUFBLEdBQUcsRUFBRXJCO0FBRCtHLFNBQWhELENBQWxELENBQXBCO0FBR0QsT0FKOEIsRUFJNUIsQ0FBQ0Esc0JBQUQsRUFBeUJkLGdCQUF6QixFQUEyQ3JELGdCQUEzQyxDQUo0QixDQUEvQjtBQU9BLFVBQUl5RixhQUFhLEdBQUcsQ0FBQyxHQUFHeEgsTUFBTSxDQUFDNkYsT0FBWCxFQUFvQixZQUFZO0FBQ2xELFlBQUl6RCx3QkFBSixFQUE4QjtBQUk1QixpQkFBb0JwQyxNQUFNLENBQUMsU0FBRCxDQUFOLENBQWtCdUcsYUFBbEIsQ0FBZ0NILFlBQVksQ0FBQ3FCLFFBQTdDLEVBQXVEO0FBQ3pFQyxZQUFBQSxLQUFLLEVBQUVWO0FBRGtFLFdBQXZELEVBRWpCTSx3QkFGaUIsQ0FBcEI7QUFHRDs7QUFFRCxlQUFPQSx3QkFBUDtBQUNELE9BWG1CLEVBV2pCLENBQUNsQixZQUFELEVBQWVrQix3QkFBZixFQUF5Q04sc0JBQXpDLENBWGlCLENBQXBCO0FBWUEsYUFBT1EsYUFBUDtBQUNEOztBQUdELFFBQUlHLE9BQU8sR0FBR2xDLElBQUksR0FBR3pGLE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0I0SCxJQUFsQixDQUF1QjdCLGVBQXZCLENBQUgsR0FBNkNBLGVBQS9EO0FBQ0E0QixJQUFBQSxPQUFPLENBQUN2QyxnQkFBUixHQUEyQkEsZ0JBQTNCO0FBQ0F1QyxJQUFBQSxPQUFPLENBQUNwQyxXQUFSLEdBQXNCUSxlQUFlLENBQUNSLFdBQWhCLEdBQThCQSxXQUFwRDs7QUFFQSxRQUFJZixVQUFKLEVBQWdCO0FBQ2QsVUFBSXFELFNBQVMsR0FBRzdILE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0J3RSxVQUFsQixDQUE2QixTQUFTc0QsaUJBQVQsQ0FBMkI5QixLQUEzQixFQUFrQ3VCLEdBQWxDLEVBQXVDO0FBQ2xGLGVBQW9CdkgsTUFBTSxDQUFDLFNBQUQsQ0FBTixDQUFrQnVHLGFBQWxCLENBQWdDb0IsT0FBaEMsRUFBeUMsQ0FBQyxHQUFHOUgsU0FBUyxDQUFDLFNBQUQsQ0FBYixFQUEwQixFQUExQixFQUE4Qm1HLEtBQTlCLEVBQXFDO0FBQ2hHRSxVQUFBQSxzQkFBc0IsRUFBRXFCO0FBRHdFLFNBQXJDLENBQXpDLENBQXBCO0FBR0QsT0FKZSxDQUFoQjs7QUFNQU0sTUFBQUEsU0FBUyxDQUFDdEMsV0FBVixHQUF3QkEsV0FBeEI7QUFDQXNDLE1BQUFBLFNBQVMsQ0FBQ3pDLGdCQUFWLEdBQTZCQSxnQkFBN0I7QUFDQSxhQUFPLENBQUMsR0FBR3JGLHFCQUFxQixDQUFDLFNBQUQsQ0FBekIsRUFBc0M4SCxTQUF0QyxFQUFpRHpDLGdCQUFqRCxDQUFQO0FBQ0Q7O0FBRUQsV0FBTyxDQUFDLEdBQUdyRixxQkFBcUIsQ0FBQyxTQUFELENBQXpCLEVBQXNDNEgsT0FBdEMsRUFBK0N2QyxnQkFBL0MsQ0FBUDtBQUNELEdBM0xEO0FBNExEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0XCIpW1wiZGVmYXVsdFwiXTtcblxudmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVXaWxkY2FyZFwiKVtcImRlZmF1bHRcIl07XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IGNvbm5lY3RBZHZhbmNlZDtcblxudmFyIF9leHRlbmRzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXh0ZW5kc1wiKSk7XG5cbnZhciBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2VcIikpO1xuXG52YXIgX2hvaXN0Tm9uUmVhY3RTdGF0aWNzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiaG9pc3Qtbm9uLXJlYWN0LXN0YXRpY3NcIikpO1xuXG52YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF9yZWFjdElzID0gcmVxdWlyZShcInJlYWN0LWlzXCIpO1xuXG52YXIgX1N1YnNjcmlwdGlvbiA9IHJlcXVpcmUoXCIuLi91dGlscy9TdWJzY3JpcHRpb25cIik7XG5cbnZhciBfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCA9IHJlcXVpcmUoXCIuLi91dGlscy91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0XCIpO1xuXG52YXIgX0NvbnRleHQgPSByZXF1aXJlKFwiLi9Db250ZXh0XCIpO1xuXG52YXIgX2V4Y2x1ZGVkID0gW1wiZ2V0RGlzcGxheU5hbWVcIiwgXCJtZXRob2ROYW1lXCIsIFwicmVuZGVyQ291bnRQcm9wXCIsIFwic2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzXCIsIFwic3RvcmVLZXlcIiwgXCJ3aXRoUmVmXCIsIFwiZm9yd2FyZFJlZlwiLCBcImNvbnRleHRcIl0sXG4gICAgX2V4Y2x1ZGVkMiA9IFtcInJlYWN0UmVkdXhGb3J3YXJkZWRSZWZcIl07XG4vLyBEZWZpbmUgc29tZSBjb25zdGFudCBhcnJheXMganVzdCB0byBhdm9pZCByZS1jcmVhdGluZyB0aGVzZVxudmFyIEVNUFRZX0FSUkFZID0gW107XG52YXIgTk9fU1VCU0NSSVBUSU9OX0FSUkFZID0gW251bGwsIG51bGxdO1xuXG52YXIgc3RyaW5naWZ5Q29tcG9uZW50ID0gZnVuY3Rpb24gc3RyaW5naWZ5Q29tcG9uZW50KENvbXApIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoQ29tcCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBTdHJpbmcoQ29tcCk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHN0b3JlU3RhdGVVcGRhdGVzUmVkdWNlcihzdGF0ZSwgYWN0aW9uKSB7XG4gIHZhciB1cGRhdGVDb3VudCA9IHN0YXRlWzFdO1xuICByZXR1cm4gW2FjdGlvbi5wYXlsb2FkLCB1cGRhdGVDb3VudCArIDFdO1xufVxuXG5mdW5jdGlvbiB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0V2l0aEFyZ3MoZWZmZWN0RnVuYywgZWZmZWN0QXJncywgZGVwZW5kZW5jaWVzKSB7XG4gICgwLCBfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdC51c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KShmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGVmZmVjdEZ1bmMuYXBwbHkodm9pZCAwLCBlZmZlY3RBcmdzKTtcbiAgfSwgZGVwZW5kZW5jaWVzKTtcbn1cblxuZnVuY3Rpb24gY2FwdHVyZVdyYXBwZXJQcm9wcyhsYXN0V3JhcHBlclByb3BzLCBsYXN0Q2hpbGRQcm9wcywgcmVuZGVySXNTY2hlZHVsZWQsIHdyYXBwZXJQcm9wcywgYWN0dWFsQ2hpbGRQcm9wcywgY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZSwgbm90aWZ5TmVzdGVkU3Vicykge1xuICAvLyBXZSB3YW50IHRvIGNhcHR1cmUgdGhlIHdyYXBwZXIgcHJvcHMgYW5kIGNoaWxkIHByb3BzIHdlIHVzZWQgZm9yIGxhdGVyIGNvbXBhcmlzb25zXG4gIGxhc3RXcmFwcGVyUHJvcHMuY3VycmVudCA9IHdyYXBwZXJQcm9wcztcbiAgbGFzdENoaWxkUHJvcHMuY3VycmVudCA9IGFjdHVhbENoaWxkUHJvcHM7XG4gIHJlbmRlcklzU2NoZWR1bGVkLmN1cnJlbnQgPSBmYWxzZTsgLy8gSWYgdGhlIHJlbmRlciB3YXMgZnJvbSBhIHN0b3JlIHVwZGF0ZSwgY2xlYXIgb3V0IHRoYXQgcmVmZXJlbmNlIGFuZCBjYXNjYWRlIHRoZSBzdWJzY3JpYmVyIHVwZGF0ZVxuXG4gIGlmIChjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQpIHtcbiAgICBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQgPSBudWxsO1xuICAgIG5vdGlmeU5lc3RlZFN1YnMoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzdWJzY3JpYmVVcGRhdGVzKHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcywgc3RvcmUsIHN1YnNjcmlwdGlvbiwgY2hpbGRQcm9wc1NlbGVjdG9yLCBsYXN0V3JhcHBlclByb3BzLCBsYXN0Q2hpbGRQcm9wcywgcmVuZGVySXNTY2hlZHVsZWQsIGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUsIG5vdGlmeU5lc3RlZFN1YnMsIGZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2gpIHtcbiAgLy8gSWYgd2UncmUgbm90IHN1YnNjcmliZWQgdG8gdGhlIHN0b3JlLCBub3RoaW5nIHRvIGRvIGhlcmVcbiAgaWYgKCFzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMpIHJldHVybjsgLy8gQ2FwdHVyZSB2YWx1ZXMgZm9yIGNoZWNraW5nIGlmIGFuZCB3aGVuIHRoaXMgY29tcG9uZW50IHVubW91bnRzXG5cbiAgdmFyIGRpZFVuc3Vic2NyaWJlID0gZmFsc2U7XG4gIHZhciBsYXN0VGhyb3duRXJyb3IgPSBudWxsOyAvLyBXZSdsbCBydW4gdGhpcyBjYWxsYmFjayBldmVyeSB0aW1lIGEgc3RvcmUgc3Vic2NyaXB0aW9uIHVwZGF0ZSBwcm9wYWdhdGVzIHRvIHRoaXMgY29tcG9uZW50XG5cbiAgdmFyIGNoZWNrRm9yVXBkYXRlcyA9IGZ1bmN0aW9uIGNoZWNrRm9yVXBkYXRlcygpIHtcbiAgICBpZiAoZGlkVW5zdWJzY3JpYmUpIHtcbiAgICAgIC8vIERvbid0IHJ1biBzdGFsZSBsaXN0ZW5lcnMuXG4gICAgICAvLyBSZWR1eCBkb2Vzbid0IGd1YXJhbnRlZSB1bnN1YnNjcmlwdGlvbnMgaGFwcGVuIHVudGlsIG5leHQgZGlzcGF0Y2guXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGxhdGVzdFN0b3JlU3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuICAgIHZhciBuZXdDaGlsZFByb3BzLCBlcnJvcjtcblxuICAgIHRyeSB7XG4gICAgICAvLyBBY3R1YWxseSBydW4gdGhlIHNlbGVjdG9yIHdpdGggdGhlIG1vc3QgcmVjZW50IHN0b3JlIHN0YXRlIGFuZCB3cmFwcGVyIHByb3BzXG4gICAgICAvLyB0byBkZXRlcm1pbmUgd2hhdCB0aGUgY2hpbGQgcHJvcHMgc2hvdWxkIGJlXG4gICAgICBuZXdDaGlsZFByb3BzID0gY2hpbGRQcm9wc1NlbGVjdG9yKGxhdGVzdFN0b3JlU3RhdGUsIGxhc3RXcmFwcGVyUHJvcHMuY3VycmVudCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyb3IgPSBlO1xuICAgICAgbGFzdFRocm93bkVycm9yID0gZTtcbiAgICB9XG5cbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICBsYXN0VGhyb3duRXJyb3IgPSBudWxsO1xuICAgIH0gLy8gSWYgdGhlIGNoaWxkIHByb3BzIGhhdmVuJ3QgY2hhbmdlZCwgbm90aGluZyB0byBkbyBoZXJlIC0gY2FzY2FkZSB0aGUgc3Vic2NyaXB0aW9uIHVwZGF0ZVxuXG5cbiAgICBpZiAobmV3Q2hpbGRQcm9wcyA9PT0gbGFzdENoaWxkUHJvcHMuY3VycmVudCkge1xuICAgICAgaWYgKCFyZW5kZXJJc1NjaGVkdWxlZC5jdXJyZW50KSB7XG4gICAgICAgIG5vdGlmeU5lc3RlZFN1YnMoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU2F2ZSByZWZlcmVuY2VzIHRvIHRoZSBuZXcgY2hpbGQgcHJvcHMuICBOb3RlIHRoYXQgd2UgdHJhY2sgdGhlIFwiY2hpbGQgcHJvcHMgZnJvbSBzdG9yZSB1cGRhdGVcIlxuICAgICAgLy8gYXMgYSByZWYgaW5zdGVhZCBvZiBhIHVzZVN0YXRlL3VzZVJlZHVjZXIgYmVjYXVzZSB3ZSBuZWVkIGEgd2F5IHRvIGRldGVybWluZSBpZiB0aGF0IHZhbHVlIGhhc1xuICAgICAgLy8gYmVlbiBwcm9jZXNzZWQuICBJZiB0aGlzIHdlbnQgaW50byB1c2VTdGF0ZS91c2VSZWR1Y2VyLCB3ZSBjb3VsZG4ndCBjbGVhciBvdXQgdGhlIHZhbHVlIHdpdGhvdXRcbiAgICAgIC8vIGZvcmNpbmcgYW5vdGhlciByZS1yZW5kZXIsIHdoaWNoIHdlIGRvbid0IHdhbnQuXG4gICAgICBsYXN0Q2hpbGRQcm9wcy5jdXJyZW50ID0gbmV3Q2hpbGRQcm9wcztcbiAgICAgIGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCA9IG5ld0NoaWxkUHJvcHM7XG4gICAgICByZW5kZXJJc1NjaGVkdWxlZC5jdXJyZW50ID0gdHJ1ZTsgLy8gSWYgdGhlIGNoaWxkIHByb3BzIF9kaWRfIGNoYW5nZSAob3Igd2UgY2F1Z2h0IGFuIGVycm9yKSwgdGhpcyB3cmFwcGVyIGNvbXBvbmVudCBuZWVkcyB0byByZS1yZW5kZXJcblxuICAgICAgZm9yY2VDb21wb25lbnRVcGRhdGVEaXNwYXRjaCh7XG4gICAgICAgIHR5cGU6ICdTVE9SRV9VUERBVEVEJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGVycm9yOiBlcnJvclxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07IC8vIEFjdHVhbGx5IHN1YnNjcmliZSB0byB0aGUgbmVhcmVzdCBjb25uZWN0ZWQgYW5jZXN0b3IgKG9yIHN0b3JlKVxuXG5cbiAgc3Vic2NyaXB0aW9uLm9uU3RhdGVDaGFuZ2UgPSBjaGVja0ZvclVwZGF0ZXM7XG4gIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTsgLy8gUHVsbCBkYXRhIGZyb20gdGhlIHN0b3JlIGFmdGVyIGZpcnN0IHJlbmRlciBpbiBjYXNlIHRoZSBzdG9yZSBoYXNcbiAgLy8gY2hhbmdlZCBzaW5jZSB3ZSBiZWdhbi5cblxuICBjaGVja0ZvclVwZGF0ZXMoKTtcblxuICB2YXIgdW5zdWJzY3JpYmVXcmFwcGVyID0gZnVuY3Rpb24gdW5zdWJzY3JpYmVXcmFwcGVyKCkge1xuICAgIGRpZFVuc3Vic2NyaWJlID0gdHJ1ZTtcbiAgICBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICBzdWJzY3JpcHRpb24ub25TdGF0ZUNoYW5nZSA9IG51bGw7XG5cbiAgICBpZiAobGFzdFRocm93bkVycm9yKSB7XG4gICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2UgY2F1Z2h0IGFuIGVycm9yIGR1ZSB0byBhIGJhZCBtYXBTdGF0ZSBmdW5jdGlvbiwgYnV0IHRoZVxuICAgICAgLy8gcGFyZW50IHJlLXJlbmRlcmVkIHdpdGhvdXQgdGhpcyBjb21wb25lbnQgYW5kIHdlJ3JlIGFib3V0IHRvIHVubW91bnQuXG4gICAgICAvLyBUaGlzIHNob3VsZG4ndCBoYXBwZW4gYXMgbG9uZyBhcyB3ZSBkbyB0b3AtZG93biBzdWJzY3JpcHRpb25zIGNvcnJlY3RseSwgYnV0XG4gICAgICAvLyBpZiB3ZSBldmVyIGRvIHRob3NlIHdyb25nLCB0aGlzIHRocm93IHdpbGwgc3VyZmFjZSB0aGUgZXJyb3IgaW4gb3VyIHRlc3RzLlxuICAgICAgLy8gSW4gdGhhdCBjYXNlLCB0aHJvdyB0aGUgZXJyb3IgZnJvbSBoZXJlIHNvIGl0IGRvZXNuJ3QgZ2V0IGxvc3QuXG4gICAgICB0aHJvdyBsYXN0VGhyb3duRXJyb3I7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB1bnN1YnNjcmliZVdyYXBwZXI7XG59XG5cbnZhciBpbml0U3RhdGVVcGRhdGVzID0gZnVuY3Rpb24gaW5pdFN0YXRlVXBkYXRlcygpIHtcbiAgcmV0dXJuIFtudWxsLCAwXTtcbn07XG5cbmZ1bmN0aW9uIGNvbm5lY3RBZHZhbmNlZChcbi8qXG4gIHNlbGVjdG9yRmFjdG9yeSBpcyBhIGZ1bmMgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgcmV0dXJuaW5nIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB1c2VkIHRvXG4gIGNvbXB1dGUgbmV3IHByb3BzIGZyb20gc3RhdGUsIHByb3BzLCBhbmQgZGlzcGF0Y2guIEZvciBleGFtcGxlOlxuICAgICBleHBvcnQgZGVmYXVsdCBjb25uZWN0QWR2YW5jZWQoKGRpc3BhdGNoLCBvcHRpb25zKSA9PiAoc3RhdGUsIHByb3BzKSA9PiAoe1xuICAgICAgdGhpbmc6IHN0YXRlLnRoaW5nc1twcm9wcy50aGluZ0lkXSxcbiAgICAgIHNhdmVUaGluZzogZmllbGRzID0+IGRpc3BhdGNoKGFjdGlvbkNyZWF0b3JzLnNhdmVUaGluZyhwcm9wcy50aGluZ0lkLCBmaWVsZHMpKSxcbiAgICB9KSkoWW91ckNvbXBvbmVudClcbiAgIEFjY2VzcyB0byBkaXNwYXRjaCBpcyBwcm92aWRlZCB0byB0aGUgZmFjdG9yeSBzbyBzZWxlY3RvckZhY3RvcmllcyBjYW4gYmluZCBhY3Rpb25DcmVhdG9yc1xuICBvdXRzaWRlIG9mIHRoZWlyIHNlbGVjdG9yIGFzIGFuIG9wdGltaXphdGlvbi4gT3B0aW9ucyBwYXNzZWQgdG8gY29ubmVjdEFkdmFuY2VkIGFyZSBwYXNzZWQgdG9cbiAgdGhlIHNlbGVjdG9yRmFjdG9yeSwgYWxvbmcgd2l0aCBkaXNwbGF5TmFtZSBhbmQgV3JhcHBlZENvbXBvbmVudCwgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cbiAgIE5vdGUgdGhhdCBzZWxlY3RvckZhY3RvcnkgaXMgcmVzcG9uc2libGUgZm9yIGFsbCBjYWNoaW5nL21lbW9pemF0aW9uIG9mIGluYm91bmQgYW5kIG91dGJvdW5kXG4gIHByb3BzLiBEbyBub3QgdXNlIGNvbm5lY3RBZHZhbmNlZCBkaXJlY3RseSB3aXRob3V0IG1lbW9pemluZyByZXN1bHRzIGJldHdlZW4gY2FsbHMgdG8geW91clxuICBzZWxlY3Rvciwgb3RoZXJ3aXNlIHRoZSBDb25uZWN0IGNvbXBvbmVudCB3aWxsIHJlLXJlbmRlciBvbiBldmVyeSBzdGF0ZSBvciBwcm9wcyBjaGFuZ2UuXG4qL1xuc2VsZWN0b3JGYWN0b3J5LCAvLyBvcHRpb25zIG9iamVjdDpcbl9yZWYpIHtcbiAgaWYgKF9yZWYgPT09IHZvaWQgMCkge1xuICAgIF9yZWYgPSB7fTtcbiAgfVxuXG4gIHZhciBfcmVmMiA9IF9yZWYsXG4gICAgICBfcmVmMiRnZXREaXNwbGF5TmFtZSA9IF9yZWYyLmdldERpc3BsYXlOYW1lLFxuICAgICAgZ2V0RGlzcGxheU5hbWUgPSBfcmVmMiRnZXREaXNwbGF5TmFtZSA9PT0gdm9pZCAwID8gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICByZXR1cm4gXCJDb25uZWN0QWR2YW5jZWQoXCIgKyBuYW1lICsgXCIpXCI7XG4gIH0gOiBfcmVmMiRnZXREaXNwbGF5TmFtZSxcbiAgICAgIF9yZWYyJG1ldGhvZE5hbWUgPSBfcmVmMi5tZXRob2ROYW1lLFxuICAgICAgbWV0aG9kTmFtZSA9IF9yZWYyJG1ldGhvZE5hbWUgPT09IHZvaWQgMCA/ICdjb25uZWN0QWR2YW5jZWQnIDogX3JlZjIkbWV0aG9kTmFtZSxcbiAgICAgIF9yZWYyJHJlbmRlckNvdW50UHJvcCA9IF9yZWYyLnJlbmRlckNvdW50UHJvcCxcbiAgICAgIHJlbmRlckNvdW50UHJvcCA9IF9yZWYyJHJlbmRlckNvdW50UHJvcCA9PT0gdm9pZCAwID8gdW5kZWZpbmVkIDogX3JlZjIkcmVuZGVyQ291bnRQcm9wLFxuICAgICAgX3JlZjIkc2hvdWxkSGFuZGxlU3RhID0gX3JlZjIuc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzLFxuICAgICAgc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzID0gX3JlZjIkc2hvdWxkSGFuZGxlU3RhID09PSB2b2lkIDAgPyB0cnVlIDogX3JlZjIkc2hvdWxkSGFuZGxlU3RhLFxuICAgICAgX3JlZjIkc3RvcmVLZXkgPSBfcmVmMi5zdG9yZUtleSxcbiAgICAgIHN0b3JlS2V5ID0gX3JlZjIkc3RvcmVLZXkgPT09IHZvaWQgMCA/ICdzdG9yZScgOiBfcmVmMiRzdG9yZUtleSxcbiAgICAgIF9yZWYyJHdpdGhSZWYgPSBfcmVmMi53aXRoUmVmLFxuICAgICAgd2l0aFJlZiA9IF9yZWYyJHdpdGhSZWYgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIkd2l0aFJlZixcbiAgICAgIF9yZWYyJGZvcndhcmRSZWYgPSBfcmVmMi5mb3J3YXJkUmVmLFxuICAgICAgZm9yd2FyZFJlZiA9IF9yZWYyJGZvcndhcmRSZWYgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIkZm9yd2FyZFJlZixcbiAgICAgIF9yZWYyJGNvbnRleHQgPSBfcmVmMi5jb250ZXh0LFxuICAgICAgY29udGV4dCA9IF9yZWYyJGNvbnRleHQgPT09IHZvaWQgMCA/IF9Db250ZXh0LlJlYWN0UmVkdXhDb250ZXh0IDogX3JlZjIkY29udGV4dCxcbiAgICAgIGNvbm5lY3RPcHRpb25zID0gKDAsIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMltcImRlZmF1bHRcIl0pKF9yZWYyLCBfZXhjbHVkZWQpO1xuXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgaWYgKHJlbmRlckNvdW50UHJvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJyZW5kZXJDb3VudFByb3AgaXMgcmVtb3ZlZC4gcmVuZGVyIGNvdW50aW5nIGlzIGJ1aWx0IGludG8gdGhlIGxhdGVzdCBSZWFjdCBEZXYgVG9vbHMgcHJvZmlsaW5nIGV4dGVuc2lvblwiKTtcbiAgICB9XG5cbiAgICBpZiAod2l0aFJlZikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd3aXRoUmVmIGlzIHJlbW92ZWQuIFRvIGFjY2VzcyB0aGUgd3JhcHBlZCBpbnN0YW5jZSwgdXNlIGEgcmVmIG9uIHRoZSBjb25uZWN0ZWQgY29tcG9uZW50Jyk7XG4gICAgfVxuXG4gICAgdmFyIGN1c3RvbVN0b3JlV2FybmluZ01lc3NhZ2UgPSAnVG8gdXNlIGEgY3VzdG9tIFJlZHV4IHN0b3JlIGZvciBzcGVjaWZpYyBjb21wb25lbnRzLCBjcmVhdGUgYSBjdXN0b20gUmVhY3QgY29udGV4dCB3aXRoICcgKyBcIlJlYWN0LmNyZWF0ZUNvbnRleHQoKSwgYW5kIHBhc3MgdGhlIGNvbnRleHQgb2JqZWN0IHRvIFJlYWN0IFJlZHV4J3MgUHJvdmlkZXIgYW5kIHNwZWNpZmljIGNvbXBvbmVudHNcIiArICcgbGlrZTogPFByb3ZpZGVyIGNvbnRleHQ9e015Q29udGV4dH0+PENvbm5lY3RlZENvbXBvbmVudCBjb250ZXh0PXtNeUNvbnRleHR9IC8+PC9Qcm92aWRlcj4uICcgKyAnWW91IG1heSBhbHNvIHBhc3MgYSB7Y29udGV4dCA6IE15Q29udGV4dH0gb3B0aW9uIHRvIGNvbm5lY3QnO1xuXG4gICAgaWYgKHN0b3JlS2V5ICE9PSAnc3RvcmUnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0b3JlS2V5IGhhcyBiZWVuIHJlbW92ZWQgYW5kIGRvZXMgbm90IGRvIGFueXRoaW5nLiAnICsgY3VzdG9tU3RvcmVXYXJuaW5nTWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIENvbnRleHQgPSBjb250ZXh0O1xuICByZXR1cm4gZnVuY3Rpb24gd3JhcFdpdGhDb25uZWN0KFdyYXBwZWRDb21wb25lbnQpIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhKDAsIF9yZWFjdElzLmlzVmFsaWRFbGVtZW50VHlwZSkoV3JhcHBlZENvbXBvbmVudCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBtdXN0IHBhc3MgYSBjb21wb25lbnQgdG8gdGhlIGZ1bmN0aW9uIHJldHVybmVkIGJ5IFwiICsgKG1ldGhvZE5hbWUgKyBcIi4gSW5zdGVhZCByZWNlaXZlZCBcIiArIHN0cmluZ2lmeUNvbXBvbmVudChXcmFwcGVkQ29tcG9uZW50KSkpO1xuICAgIH1cblxuICAgIHZhciB3cmFwcGVkQ29tcG9uZW50TmFtZSA9IFdyYXBwZWRDb21wb25lbnQuZGlzcGxheU5hbWUgfHwgV3JhcHBlZENvbXBvbmVudC5uYW1lIHx8ICdDb21wb25lbnQnO1xuICAgIHZhciBkaXNwbGF5TmFtZSA9IGdldERpc3BsYXlOYW1lKHdyYXBwZWRDb21wb25lbnROYW1lKTtcbiAgICB2YXIgc2VsZWN0b3JGYWN0b3J5T3B0aW9ucyA9ICgwLCBfZXh0ZW5kczJbXCJkZWZhdWx0XCJdKSh7fSwgY29ubmVjdE9wdGlvbnMsIHtcbiAgICAgIGdldERpc3BsYXlOYW1lOiBnZXREaXNwbGF5TmFtZSxcbiAgICAgIG1ldGhvZE5hbWU6IG1ldGhvZE5hbWUsXG4gICAgICByZW5kZXJDb3VudFByb3A6IHJlbmRlckNvdW50UHJvcCxcbiAgICAgIHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlczogc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzLFxuICAgICAgc3RvcmVLZXk6IHN0b3JlS2V5LFxuICAgICAgZGlzcGxheU5hbWU6IGRpc3BsYXlOYW1lLFxuICAgICAgd3JhcHBlZENvbXBvbmVudE5hbWU6IHdyYXBwZWRDb21wb25lbnROYW1lLFxuICAgICAgV3JhcHBlZENvbXBvbmVudDogV3JhcHBlZENvbXBvbmVudFxuICAgIH0pO1xuICAgIHZhciBwdXJlID0gY29ubmVjdE9wdGlvbnMucHVyZTtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUNoaWxkU2VsZWN0b3Ioc3RvcmUpIHtcbiAgICAgIHJldHVybiBzZWxlY3RvckZhY3Rvcnkoc3RvcmUuZGlzcGF0Y2gsIHNlbGVjdG9yRmFjdG9yeU9wdGlvbnMpO1xuICAgIH0gLy8gSWYgd2UgYXJlbid0IHJ1bm5pbmcgaW4gXCJwdXJlXCIgbW9kZSwgd2UgZG9uJ3Qgd2FudCB0byBtZW1vaXplIHZhbHVlcy5cbiAgICAvLyBUbyBhdm9pZCBjb25kaXRpb25hbGx5IGNhbGxpbmcgaG9va3MsIHdlIGZhbGwgYmFjayB0byBhIHRpbnkgd3JhcHBlclxuICAgIC8vIHRoYXQganVzdCBleGVjdXRlcyB0aGUgZ2l2ZW4gY2FsbGJhY2sgaW1tZWRpYXRlbHkuXG5cblxuICAgIHZhciB1c2VQdXJlT25seU1lbW8gPSBwdXJlID8gX3JlYWN0LnVzZU1lbW8gOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBDb25uZWN0RnVuY3Rpb24ocHJvcHMpIHtcbiAgICAgIHZhciBfdXNlTWVtbyA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBEaXN0aW5ndWlzaCBiZXR3ZWVuIGFjdHVhbCBcImRhdGFcIiBwcm9wcyB0aGF0IHdlcmUgcGFzc2VkIHRvIHRoZSB3cmFwcGVyIGNvbXBvbmVudCxcbiAgICAgICAgLy8gYW5kIHZhbHVlcyBuZWVkZWQgdG8gY29udHJvbCBiZWhhdmlvciAoZm9yd2FyZGVkIHJlZnMsIGFsdGVybmF0ZSBjb250ZXh0IGluc3RhbmNlcykuXG4gICAgICAgIC8vIFRvIG1haW50YWluIHRoZSB3cmFwcGVyUHJvcHMgb2JqZWN0IHJlZmVyZW5jZSwgbWVtb2l6ZSB0aGlzIGRlc3RydWN0dXJpbmcuXG4gICAgICAgIHZhciByZWFjdFJlZHV4Rm9yd2FyZGVkUmVmID0gcHJvcHMucmVhY3RSZWR1eEZvcndhcmRlZFJlZixcbiAgICAgICAgICAgIHdyYXBwZXJQcm9wcyA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTJbXCJkZWZhdWx0XCJdKShwcm9wcywgX2V4Y2x1ZGVkMik7XG4gICAgICAgIHJldHVybiBbcHJvcHMuY29udGV4dCwgcmVhY3RSZWR1eEZvcndhcmRlZFJlZiwgd3JhcHBlclByb3BzXTtcbiAgICAgIH0sIFtwcm9wc10pLFxuICAgICAgICAgIHByb3BzQ29udGV4dCA9IF91c2VNZW1vWzBdLFxuICAgICAgICAgIHJlYWN0UmVkdXhGb3J3YXJkZWRSZWYgPSBfdXNlTWVtb1sxXSxcbiAgICAgICAgICB3cmFwcGVyUHJvcHMgPSBfdXNlTWVtb1syXTtcblxuICAgICAgdmFyIENvbnRleHRUb1VzZSA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBVc2VycyBtYXkgb3B0aW9uYWxseSBwYXNzIGluIGEgY3VzdG9tIGNvbnRleHQgaW5zdGFuY2UgdG8gdXNlIGluc3RlYWQgb2Ygb3VyIFJlYWN0UmVkdXhDb250ZXh0LlxuICAgICAgICAvLyBNZW1vaXplIHRoZSBjaGVjayB0aGF0IGRldGVybWluZXMgd2hpY2ggY29udGV4dCBpbnN0YW5jZSB3ZSBzaG91bGQgdXNlLlxuICAgICAgICByZXR1cm4gcHJvcHNDb250ZXh0ICYmIHByb3BzQ29udGV4dC5Db25zdW1lciAmJiAoMCwgX3JlYWN0SXMuaXNDb250ZXh0Q29uc3VtZXIpKCAvKiNfX1BVUkVfXyovX3JlYWN0W1wiZGVmYXVsdFwiXS5jcmVhdGVFbGVtZW50KHByb3BzQ29udGV4dC5Db25zdW1lciwgbnVsbCkpID8gcHJvcHNDb250ZXh0IDogQ29udGV4dDtcbiAgICAgIH0sIFtwcm9wc0NvbnRleHQsIENvbnRleHRdKTsgLy8gUmV0cmlldmUgdGhlIHN0b3JlIGFuZCBhbmNlc3RvciBzdWJzY3JpcHRpb24gdmlhIGNvbnRleHQsIGlmIGF2YWlsYWJsZVxuXG4gICAgICB2YXIgY29udGV4dFZhbHVlID0gKDAsIF9yZWFjdC51c2VDb250ZXh0KShDb250ZXh0VG9Vc2UpOyAvLyBUaGUgc3RvcmUgX211c3RfIGV4aXN0IGFzIGVpdGhlciBhIHByb3Agb3IgaW4gY29udGV4dC5cbiAgICAgIC8vIFdlJ2xsIGNoZWNrIHRvIHNlZSBpZiBpdCBfbG9va3NfIGxpa2UgYSBSZWR1eCBzdG9yZSBmaXJzdC5cbiAgICAgIC8vIFRoaXMgYWxsb3dzIHVzIHRvIHBhc3MgdGhyb3VnaCBhIGBzdG9yZWAgcHJvcCB0aGF0IGlzIGp1c3QgYSBwbGFpbiB2YWx1ZS5cblxuICAgICAgdmFyIGRpZFN0b3JlQ29tZUZyb21Qcm9wcyA9IEJvb2xlYW4ocHJvcHMuc3RvcmUpICYmIEJvb2xlYW4ocHJvcHMuc3RvcmUuZ2V0U3RhdGUpICYmIEJvb2xlYW4ocHJvcHMuc3RvcmUuZGlzcGF0Y2gpO1xuICAgICAgdmFyIGRpZFN0b3JlQ29tZUZyb21Db250ZXh0ID0gQm9vbGVhbihjb250ZXh0VmFsdWUpICYmIEJvb2xlYW4oY29udGV4dFZhbHVlLnN0b3JlKTtcblxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIWRpZFN0b3JlQ29tZUZyb21Qcm9wcyAmJiAhZGlkU3RvcmVDb21lRnJvbUNvbnRleHQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgXFxcInN0b3JlXFxcIiBpbiB0aGUgY29udGV4dCBvZiBcIiArIChcIlxcXCJcIiArIGRpc3BsYXlOYW1lICsgXCJcXFwiLiBFaXRoZXIgd3JhcCB0aGUgcm9vdCBjb21wb25lbnQgaW4gYSA8UHJvdmlkZXI+LCBcIikgKyBcIm9yIHBhc3MgYSBjdXN0b20gUmVhY3QgY29udGV4dCBwcm92aWRlciB0byA8UHJvdmlkZXI+IGFuZCB0aGUgY29ycmVzcG9uZGluZyBcIiArIChcIlJlYWN0IGNvbnRleHQgY29uc3VtZXIgdG8gXCIgKyBkaXNwbGF5TmFtZSArIFwiIGluIGNvbm5lY3Qgb3B0aW9ucy5cIikpO1xuICAgICAgfSAvLyBCYXNlZCBvbiB0aGUgcHJldmlvdXMgY2hlY2ssIG9uZSBvZiB0aGVzZSBtdXN0IGJlIHRydWVcblxuXG4gICAgICB2YXIgc3RvcmUgPSBkaWRTdG9yZUNvbWVGcm9tUHJvcHMgPyBwcm9wcy5zdG9yZSA6IGNvbnRleHRWYWx1ZS5zdG9yZTtcbiAgICAgIHZhciBjaGlsZFByb3BzU2VsZWN0b3IgPSAoMCwgX3JlYWN0LnVzZU1lbW8pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVGhlIGNoaWxkIHByb3BzIHNlbGVjdG9yIG5lZWRzIHRoZSBzdG9yZSByZWZlcmVuY2UgYXMgYW4gaW5wdXQuXG4gICAgICAgIC8vIFJlLWNyZWF0ZSB0aGlzIHNlbGVjdG9yIHdoZW5ldmVyIHRoZSBzdG9yZSBjaGFuZ2VzLlxuICAgICAgICByZXR1cm4gY3JlYXRlQ2hpbGRTZWxlY3RvcihzdG9yZSk7XG4gICAgICB9LCBbc3RvcmVdKTtcblxuICAgICAgdmFyIF91c2VNZW1vMiA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcykgcmV0dXJuIE5PX1NVQlNDUklQVElPTl9BUlJBWTsgLy8gVGhpcyBTdWJzY3JpcHRpb24ncyBzb3VyY2Ugc2hvdWxkIG1hdGNoIHdoZXJlIHN0b3JlIGNhbWUgZnJvbTogcHJvcHMgdnMuIGNvbnRleHQuIEEgY29tcG9uZW50XG4gICAgICAgIC8vIGNvbm5lY3RlZCB0byB0aGUgc3RvcmUgdmlhIHByb3BzIHNob3VsZG4ndCB1c2Ugc3Vic2NyaXB0aW9uIGZyb20gY29udGV4dCwgb3IgdmljZSB2ZXJzYS5cblxuICAgICAgICAvLyBUaGlzIFN1YnNjcmlwdGlvbidzIHNvdXJjZSBzaG91bGQgbWF0Y2ggd2hlcmUgc3RvcmUgY2FtZSBmcm9tOiBwcm9wcyB2cy4gY29udGV4dC4gQSBjb21wb25lbnRcbiAgICAgICAgLy8gY29ubmVjdGVkIHRvIHRoZSBzdG9yZSB2aWEgcHJvcHMgc2hvdWxkbid0IHVzZSBzdWJzY3JpcHRpb24gZnJvbSBjb250ZXh0LCBvciB2aWNlIHZlcnNhLlxuICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gKDAsIF9TdWJzY3JpcHRpb24uY3JlYXRlU3Vic2NyaXB0aW9uKShzdG9yZSwgZGlkU3RvcmVDb21lRnJvbVByb3BzID8gbnVsbCA6IGNvbnRleHRWYWx1ZS5zdWJzY3JpcHRpb24pOyAvLyBgbm90aWZ5TmVzdGVkU3Vic2AgaXMgZHVwbGljYXRlZCB0byBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIGNvbXBvbmVudCBpcyB1bm1vdW50ZWQgaW5cbiAgICAgICAgLy8gdGhlIG1pZGRsZSBvZiB0aGUgbm90aWZpY2F0aW9uIGxvb3AsIHdoZXJlIGBzdWJzY3JpcHRpb25gIHdpbGwgdGhlbiBiZSBudWxsLiBUaGlzIGNhblxuICAgICAgICAvLyBwcm9iYWJseSBiZSBhdm9pZGVkIGlmIFN1YnNjcmlwdGlvbidzIGxpc3RlbmVycyBsb2dpYyBpcyBjaGFuZ2VkIHRvIG5vdCBjYWxsIGxpc3RlbmVyc1xuICAgICAgICAvLyB0aGF0IGhhdmUgYmVlbiB1bnN1YnNjcmliZWQgaW4gdGhlICBtaWRkbGUgb2YgdGhlIG5vdGlmaWNhdGlvbiBsb29wLlxuXG4gICAgICAgIC8vIGBub3RpZnlOZXN0ZWRTdWJzYCBpcyBkdXBsaWNhdGVkIHRvIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgY29tcG9uZW50IGlzIHVubW91bnRlZCBpblxuICAgICAgICAvLyB0aGUgbWlkZGxlIG9mIHRoZSBub3RpZmljYXRpb24gbG9vcCwgd2hlcmUgYHN1YnNjcmlwdGlvbmAgd2lsbCB0aGVuIGJlIG51bGwuIFRoaXMgY2FuXG4gICAgICAgIC8vIHByb2JhYmx5IGJlIGF2b2lkZWQgaWYgU3Vic2NyaXB0aW9uJ3MgbGlzdGVuZXJzIGxvZ2ljIGlzIGNoYW5nZWQgdG8gbm90IGNhbGwgbGlzdGVuZXJzXG4gICAgICAgIC8vIHRoYXQgaGF2ZSBiZWVuIHVuc3Vic2NyaWJlZCBpbiB0aGUgIG1pZGRsZSBvZiB0aGUgbm90aWZpY2F0aW9uIGxvb3AuXG4gICAgICAgIHZhciBub3RpZnlOZXN0ZWRTdWJzID0gc3Vic2NyaXB0aW9uLm5vdGlmeU5lc3RlZFN1YnMuYmluZChzdWJzY3JpcHRpb24pO1xuICAgICAgICByZXR1cm4gW3N1YnNjcmlwdGlvbiwgbm90aWZ5TmVzdGVkU3Vic107XG4gICAgICB9LCBbc3RvcmUsIGRpZFN0b3JlQ29tZUZyb21Qcm9wcywgY29udGV4dFZhbHVlXSksXG4gICAgICAgICAgc3Vic2NyaXB0aW9uID0gX3VzZU1lbW8yWzBdLFxuICAgICAgICAgIG5vdGlmeU5lc3RlZFN1YnMgPSBfdXNlTWVtbzJbMV07IC8vIERldGVybWluZSB3aGF0IHtzdG9yZSwgc3Vic2NyaXB0aW9ufSB2YWx1ZSBzaG91bGQgYmUgcHV0IGludG8gbmVzdGVkIGNvbnRleHQsIGlmIG5lY2Vzc2FyeSxcbiAgICAgIC8vIGFuZCBtZW1vaXplIHRoYXQgdmFsdWUgdG8gYXZvaWQgdW5uZWNlc3NhcnkgY29udGV4dCB1cGRhdGVzLlxuXG5cbiAgICAgIHZhciBvdmVycmlkZGVuQ29udGV4dFZhbHVlID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChkaWRTdG9yZUNvbWVGcm9tUHJvcHMpIHtcbiAgICAgICAgICAvLyBUaGlzIGNvbXBvbmVudCBpcyBkaXJlY3RseSBzdWJzY3JpYmVkIHRvIGEgc3RvcmUgZnJvbSBwcm9wcy5cbiAgICAgICAgICAvLyBXZSBkb24ndCB3YW50IGRlc2NlbmRhbnRzIHJlYWRpbmcgZnJvbSB0aGlzIHN0b3JlIC0gcGFzcyBkb3duIHdoYXRldmVyXG4gICAgICAgICAgLy8gdGhlIGV4aXN0aW5nIGNvbnRleHQgdmFsdWUgaXMgZnJvbSB0aGUgbmVhcmVzdCBjb25uZWN0ZWQgYW5jZXN0b3IuXG4gICAgICAgICAgcmV0dXJuIGNvbnRleHRWYWx1ZTtcbiAgICAgICAgfSAvLyBPdGhlcndpc2UsIHB1dCB0aGlzIGNvbXBvbmVudCdzIHN1YnNjcmlwdGlvbiBpbnN0YW5jZSBpbnRvIGNvbnRleHQsIHNvIHRoYXRcbiAgICAgICAgLy8gY29ubmVjdGVkIGRlc2NlbmRhbnRzIHdvbid0IHVwZGF0ZSB1bnRpbCBhZnRlciB0aGlzIGNvbXBvbmVudCBpcyBkb25lXG5cblxuICAgICAgICByZXR1cm4gKDAsIF9leHRlbmRzMltcImRlZmF1bHRcIl0pKHt9LCBjb250ZXh0VmFsdWUsIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb246IHN1YnNjcmlwdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0sIFtkaWRTdG9yZUNvbWVGcm9tUHJvcHMsIGNvbnRleHRWYWx1ZSwgc3Vic2NyaXB0aW9uXSk7IC8vIFdlIG5lZWQgdG8gZm9yY2UgdGhpcyB3cmFwcGVyIGNvbXBvbmVudCB0byByZS1yZW5kZXIgd2hlbmV2ZXIgYSBSZWR1eCBzdG9yZSB1cGRhdGVcbiAgICAgIC8vIGNhdXNlcyBhIGNoYW5nZSB0byB0aGUgY2FsY3VsYXRlZCBjaGlsZCBjb21wb25lbnQgcHJvcHMgKG9yIHdlIGNhdWdodCBhbiBlcnJvciBpbiBtYXBTdGF0ZSlcblxuICAgICAgdmFyIF91c2VSZWR1Y2VyID0gKDAsIF9yZWFjdC51c2VSZWR1Y2VyKShzdG9yZVN0YXRlVXBkYXRlc1JlZHVjZXIsIEVNUFRZX0FSUkFZLCBpbml0U3RhdGVVcGRhdGVzKSxcbiAgICAgICAgICBfdXNlUmVkdWNlciQgPSBfdXNlUmVkdWNlclswXSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlVXBkYXRlUmVzdWx0ID0gX3VzZVJlZHVjZXIkWzBdLFxuICAgICAgICAgIGZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2ggPSBfdXNlUmVkdWNlclsxXTsgLy8gUHJvcGFnYXRlIGFueSBtYXBTdGF0ZS9tYXBEaXNwYXRjaCBlcnJvcnMgdXB3YXJkc1xuXG5cbiAgICAgIGlmIChwcmV2aW91c1N0YXRlVXBkYXRlUmVzdWx0ICYmIHByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQuZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdC5lcnJvcjtcbiAgICAgIH0gLy8gU2V0IHVwIHJlZnMgdG8gY29vcmRpbmF0ZSB2YWx1ZXMgYmV0d2VlbiB0aGUgc3Vic2NyaXB0aW9uIGVmZmVjdCBhbmQgdGhlIHJlbmRlciBsb2dpY1xuXG5cbiAgICAgIHZhciBsYXN0Q2hpbGRQcm9wcyA9ICgwLCBfcmVhY3QudXNlUmVmKSgpO1xuICAgICAgdmFyIGxhc3RXcmFwcGVyUHJvcHMgPSAoMCwgX3JlYWN0LnVzZVJlZikod3JhcHBlclByb3BzKTtcbiAgICAgIHZhciBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlID0gKDAsIF9yZWFjdC51c2VSZWYpKCk7XG4gICAgICB2YXIgcmVuZGVySXNTY2hlZHVsZWQgPSAoMCwgX3JlYWN0LnVzZVJlZikoZmFsc2UpO1xuICAgICAgdmFyIGFjdHVhbENoaWxkUHJvcHMgPSB1c2VQdXJlT25seU1lbW8oZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBUcmlja3kgbG9naWMgaGVyZTpcbiAgICAgICAgLy8gLSBUaGlzIHJlbmRlciBtYXkgaGF2ZSBiZWVuIHRyaWdnZXJlZCBieSBhIFJlZHV4IHN0b3JlIHVwZGF0ZSB0aGF0IHByb2R1Y2VkIG5ldyBjaGlsZCBwcm9wc1xuICAgICAgICAvLyAtIEhvd2V2ZXIsIHdlIG1heSBoYXZlIGdvdHRlbiBuZXcgd3JhcHBlciBwcm9wcyBhZnRlciB0aGF0XG4gICAgICAgIC8vIElmIHdlIGhhdmUgbmV3IGNoaWxkIHByb3BzLCBhbmQgdGhlIHNhbWUgd3JhcHBlciBwcm9wcywgd2Uga25vdyB3ZSBzaG91bGQgdXNlIHRoZSBuZXcgY2hpbGQgcHJvcHMgYXMtaXMuXG4gICAgICAgIC8vIEJ1dCwgaWYgd2UgaGF2ZSBuZXcgd3JhcHBlciBwcm9wcywgdGhvc2UgbWlnaHQgY2hhbmdlIHRoZSBjaGlsZCBwcm9wcywgc28gd2UgaGF2ZSB0byByZWNhbGN1bGF0ZSB0aGluZ3MuXG4gICAgICAgIC8vIFNvLCB3ZSdsbCB1c2UgdGhlIGNoaWxkIHByb3BzIGZyb20gc3RvcmUgdXBkYXRlIG9ubHkgaWYgdGhlIHdyYXBwZXIgcHJvcHMgYXJlIHRoZSBzYW1lIGFzIGxhc3QgdGltZS5cbiAgICAgICAgaWYgKGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCAmJiB3cmFwcGVyUHJvcHMgPT09IGxhc3RXcmFwcGVyUHJvcHMuY3VycmVudCkge1xuICAgICAgICAgIHJldHVybiBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQ7XG4gICAgICAgIH0gLy8gVE9ETyBXZSdyZSByZWFkaW5nIHRoZSBzdG9yZSBkaXJlY3RseSBpbiByZW5kZXIoKSBoZXJlLiBCYWQgaWRlYT9cbiAgICAgICAgLy8gVGhpcyB3aWxsIGxpa2VseSBjYXVzZSBCYWQgVGhpbmdzIChUTSkgdG8gaGFwcGVuIGluIENvbmN1cnJlbnQgTW9kZS5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvIHRoaXMgYmVjYXVzZSBvbiByZW5kZXJzIF9ub3RfIGNhdXNlZCBieSBzdG9yZSB1cGRhdGVzLCB3ZSBuZWVkIHRoZSBsYXRlc3Qgc3RvcmUgc3RhdGVcbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHdoYXQgdGhlIGNoaWxkIHByb3BzIHNob3VsZCBiZS5cblxuXG4gICAgICAgIHJldHVybiBjaGlsZFByb3BzU2VsZWN0b3Ioc3RvcmUuZ2V0U3RhdGUoKSwgd3JhcHBlclByb3BzKTtcbiAgICAgIH0sIFtzdG9yZSwgcHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdCwgd3JhcHBlclByb3BzXSk7IC8vIFdlIG5lZWQgdGhpcyB0byBleGVjdXRlIHN5bmNocm9ub3VzbHkgZXZlcnkgdGltZSB3ZSByZS1yZW5kZXIuIEhvd2V2ZXIsIFJlYWN0IHdhcm5zXG4gICAgICAvLyBhYm91dCB1c2VMYXlvdXRFZmZlY3QgaW4gU1NSLCBzbyB3ZSB0cnkgdG8gZGV0ZWN0IGVudmlyb25tZW50IGFuZCBmYWxsIGJhY2sgdG9cbiAgICAgIC8vIGp1c3QgdXNlRWZmZWN0IGluc3RlYWQgdG8gYXZvaWQgdGhlIHdhcm5pbmcsIHNpbmNlIG5laXRoZXIgd2lsbCBydW4gYW55d2F5LlxuXG4gICAgICB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0V2l0aEFyZ3MoY2FwdHVyZVdyYXBwZXJQcm9wcywgW2xhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgd3JhcHBlclByb3BzLCBhY3R1YWxDaGlsZFByb3BzLCBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLCBub3RpZnlOZXN0ZWRTdWJzXSk7IC8vIE91ciByZS1zdWJzY3JpYmUgbG9naWMgb25seSBydW5zIHdoZW4gdGhlIHN0b3JlL3N1YnNjcmlwdGlvbiBzZXR1cCBjaGFuZ2VzXG5cbiAgICAgIHVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3RXaXRoQXJncyhzdWJzY3JpYmVVcGRhdGVzLCBbc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzLCBzdG9yZSwgc3Vic2NyaXB0aW9uLCBjaGlsZFByb3BzU2VsZWN0b3IsIGxhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZSwgbm90aWZ5TmVzdGVkU3VicywgZm9yY2VDb21wb25lbnRVcGRhdGVEaXNwYXRjaF0sIFtzdG9yZSwgc3Vic2NyaXB0aW9uLCBjaGlsZFByb3BzU2VsZWN0b3JdKTsgLy8gTm93IHRoYXQgYWxsIHRoYXQncyBkb25lLCB3ZSBjYW4gZmluYWxseSB0cnkgdG8gYWN0dWFsbHkgcmVuZGVyIHRoZSBjaGlsZCBjb21wb25lbnQuXG4gICAgICAvLyBXZSBtZW1vaXplIHRoZSBlbGVtZW50cyBmb3IgdGhlIHJlbmRlcmVkIGNoaWxkIGNvbXBvbmVudCBhcyBhbiBvcHRpbWl6YXRpb24uXG5cbiAgICAgIHZhciByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQgPSAoMCwgX3JlYWN0LnVzZU1lbW8pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9fcmVhY3RbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoV3JhcHBlZENvbXBvbmVudCwgKDAsIF9leHRlbmRzMltcImRlZmF1bHRcIl0pKHt9LCBhY3R1YWxDaGlsZFByb3BzLCB7XG4gICAgICAgICAgcmVmOiByZWFjdFJlZHV4Rm9yd2FyZGVkUmVmXG4gICAgICAgIH0pKTtcbiAgICAgIH0sIFtyZWFjdFJlZHV4Rm9yd2FyZGVkUmVmLCBXcmFwcGVkQ29tcG9uZW50LCBhY3R1YWxDaGlsZFByb3BzXSk7IC8vIElmIFJlYWN0IHNlZXMgdGhlIGV4YWN0IHNhbWUgZWxlbWVudCByZWZlcmVuY2UgYXMgbGFzdCB0aW1lLCBpdCBiYWlscyBvdXQgb2YgcmUtcmVuZGVyaW5nXG4gICAgICAvLyB0aGF0IGNoaWxkLCBzYW1lIGFzIGlmIGl0IHdhcyB3cmFwcGVkIGluIFJlYWN0Lm1lbW8oKSBvciByZXR1cm5lZCBmYWxzZSBmcm9tIHNob3VsZENvbXBvbmVudFVwZGF0ZS5cblxuICAgICAgdmFyIHJlbmRlcmVkQ2hpbGQgPSAoMCwgX3JlYWN0LnVzZU1lbW8pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcykge1xuICAgICAgICAgIC8vIElmIHRoaXMgY29tcG9uZW50IGlzIHN1YnNjcmliZWQgdG8gc3RvcmUgdXBkYXRlcywgd2UgbmVlZCB0byBwYXNzIGl0cyBvd25cbiAgICAgICAgICAvLyBzdWJzY3JpcHRpb24gaW5zdGFuY2UgZG93biB0byBvdXIgZGVzY2VuZGFudHMuIFRoYXQgbWVhbnMgcmVuZGVyaW5nIHRoZSBzYW1lXG4gICAgICAgICAgLy8gQ29udGV4dCBpbnN0YW5jZSwgYW5kIHB1dHRpbmcgYSBkaWZmZXJlbnQgdmFsdWUgaW50byB0aGUgY29udGV4dC5cbiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb250ZXh0VG9Vc2UuUHJvdmlkZXIsIHtcbiAgICAgICAgICAgIHZhbHVlOiBvdmVycmlkZGVuQ29udGV4dFZhbHVlXG4gICAgICAgICAgfSwgcmVuZGVyZWRXcmFwcGVkQ29tcG9uZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQ7XG4gICAgICB9LCBbQ29udGV4dFRvVXNlLCByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQsIG92ZXJyaWRkZW5Db250ZXh0VmFsdWVdKTtcbiAgICAgIHJldHVybiByZW5kZXJlZENoaWxkO1xuICAgIH0gLy8gSWYgd2UncmUgaW4gXCJwdXJlXCIgbW9kZSwgZW5zdXJlIG91ciB3cmFwcGVyIGNvbXBvbmVudCBvbmx5IHJlLXJlbmRlcnMgd2hlbiBpbmNvbWluZyBwcm9wcyBoYXZlIGNoYW5nZWQuXG5cblxuICAgIHZhciBDb25uZWN0ID0gcHVyZSA/IF9yZWFjdFtcImRlZmF1bHRcIl0ubWVtbyhDb25uZWN0RnVuY3Rpb24pIDogQ29ubmVjdEZ1bmN0aW9uO1xuICAgIENvbm5lY3QuV3JhcHBlZENvbXBvbmVudCA9IFdyYXBwZWRDb21wb25lbnQ7XG4gICAgQ29ubmVjdC5kaXNwbGF5TmFtZSA9IENvbm5lY3RGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuXG4gICAgaWYgKGZvcndhcmRSZWYpIHtcbiAgICAgIHZhciBmb3J3YXJkZWQgPSBfcmVhY3RbXCJkZWZhdWx0XCJdLmZvcndhcmRSZWYoZnVuY3Rpb24gZm9yd2FyZENvbm5lY3RSZWYocHJvcHMsIHJlZikge1xuICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb25uZWN0LCAoMCwgX2V4dGVuZHMyW1wiZGVmYXVsdFwiXSkoe30sIHByb3BzLCB7XG4gICAgICAgICAgcmVhY3RSZWR1eEZvcndhcmRlZFJlZjogcmVmXG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuXG4gICAgICBmb3J3YXJkZWQuZGlzcGxheU5hbWUgPSBkaXNwbGF5TmFtZTtcbiAgICAgIGZvcndhcmRlZC5XcmFwcGVkQ29tcG9uZW50ID0gV3JhcHBlZENvbXBvbmVudDtcbiAgICAgIHJldHVybiAoMCwgX2hvaXN0Tm9uUmVhY3RTdGF0aWNzW1wiZGVmYXVsdFwiXSkoZm9yd2FyZGVkLCBXcmFwcGVkQ29tcG9uZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gKDAsIF9ob2lzdE5vblJlYWN0U3RhdGljc1tcImRlZmF1bHRcIl0pKENvbm5lY3QsIFdyYXBwZWRDb21wb25lbnQpO1xuICB9O1xufSJdfQ==