5e56f29d0bdb373522679a345c9c5d1f
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.test = exports.serialize = void 0;

var _collections = require("../collections");

var IS_ITERABLE_SENTINEL = '@@__IMMUTABLE_ITERABLE__@@';
var IS_LIST_SENTINEL = '@@__IMMUTABLE_LIST__@@';
var IS_KEYED_SENTINEL = '@@__IMMUTABLE_KEYED__@@';
var IS_MAP_SENTINEL = '@@__IMMUTABLE_MAP__@@';
var IS_ORDERED_SENTINEL = '@@__IMMUTABLE_ORDERED__@@';
var IS_RECORD_SENTINEL = '@@__IMMUTABLE_RECORD__@@';
var IS_SEQ_SENTINEL = '@@__IMMUTABLE_SEQ__@@';
var IS_SET_SENTINEL = '@@__IMMUTABLE_SET__@@';
var IS_STACK_SENTINEL = '@@__IMMUTABLE_STACK__@@';

var getImmutableName = function getImmutableName(name) {
  return 'Immutable.' + name;
};

var printAsLeaf = function printAsLeaf(name) {
  return '[' + name + ']';
};

var SPACE = ' ';
var LAZY = 'â€¦';

var printImmutableEntries = function printImmutableEntries(val, config, indentation, depth, refs, printer, type) {
  return ++depth > config.maxDepth ? printAsLeaf(getImmutableName(type)) : getImmutableName(type) + SPACE + '{' + (0, _collections.printIteratorEntries)(val.entries(), config, indentation, depth, refs, printer) + '}';
};

function getRecordEntries(val) {
  var i = 0;
  return {
    next: function next() {
      if (i < val._keys.length) {
        var key = val._keys[i++];
        return {
          done: false,
          value: [key, val.get(key)]
        };
      }

      return {
        done: true,
        value: undefined
      };
    }
  };
}

var printImmutableRecord = function printImmutableRecord(val, config, indentation, depth, refs, printer) {
  var name = getImmutableName(val._name || 'Record');
  return ++depth > config.maxDepth ? printAsLeaf(name) : name + SPACE + '{' + (0, _collections.printIteratorEntries)(getRecordEntries(val), config, indentation, depth, refs, printer) + '}';
};

var printImmutableSeq = function printImmutableSeq(val, config, indentation, depth, refs, printer) {
  var name = getImmutableName('Seq');

  if (++depth > config.maxDepth) {
    return printAsLeaf(name);
  }

  if (val[IS_KEYED_SENTINEL]) {
    return name + SPACE + '{' + (val._iter || val._object ? (0, _collections.printIteratorEntries)(val.entries(), config, indentation, depth, refs, printer) : LAZY) + '}';
  }

  return name + SPACE + '[' + (val._iter || val._array || val._collection || val._iterable ? (0, _collections.printIteratorValues)(val.values(), config, indentation, depth, refs, printer) : LAZY) + ']';
};

var printImmutableValues = function printImmutableValues(val, config, indentation, depth, refs, printer, type) {
  return ++depth > config.maxDepth ? printAsLeaf(getImmutableName(type)) : getImmutableName(type) + SPACE + '[' + (0, _collections.printIteratorValues)(val.values(), config, indentation, depth, refs, printer) + ']';
};

var serialize = function serialize(val, config, indentation, depth, refs, printer) {
  if (val[IS_MAP_SENTINEL]) {
    return printImmutableEntries(val, config, indentation, depth, refs, printer, val[IS_ORDERED_SENTINEL] ? 'OrderedMap' : 'Map');
  }

  if (val[IS_LIST_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, 'List');
  }

  if (val[IS_SET_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, val[IS_ORDERED_SENTINEL] ? 'OrderedSet' : 'Set');
  }

  if (val[IS_STACK_SENTINEL]) {
    return printImmutableValues(val, config, indentation, depth, refs, printer, 'Stack');
  }

  if (val[IS_SEQ_SENTINEL]) {
    return printImmutableSeq(val, config, indentation, depth, refs, printer);
  }

  return printImmutableRecord(val, config, indentation, depth, refs, printer);
};

exports.serialize = serialize;

var test = function test(val) {
  return val && (val[IS_ITERABLE_SENTINEL] === true || val[IS_RECORD_SENTINEL] === true);
};

exports.test = test;
var plugin = {
  serialize: serialize,
  test: test
};
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltbXV0YWJsZS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJ0ZXN0Iiwic2VyaWFsaXplIiwiX2NvbGxlY3Rpb25zIiwicmVxdWlyZSIsIklTX0lURVJBQkxFX1NFTlRJTkVMIiwiSVNfTElTVF9TRU5USU5FTCIsIklTX0tFWUVEX1NFTlRJTkVMIiwiSVNfTUFQX1NFTlRJTkVMIiwiSVNfT1JERVJFRF9TRU5USU5FTCIsIklTX1JFQ09SRF9TRU5USU5FTCIsIklTX1NFUV9TRU5USU5FTCIsIklTX1NFVF9TRU5USU5FTCIsIklTX1NUQUNLX1NFTlRJTkVMIiwiZ2V0SW1tdXRhYmxlTmFtZSIsIm5hbWUiLCJwcmludEFzTGVhZiIsIlNQQUNFIiwiTEFaWSIsInByaW50SW1tdXRhYmxlRW50cmllcyIsInZhbCIsImNvbmZpZyIsImluZGVudGF0aW9uIiwiZGVwdGgiLCJyZWZzIiwicHJpbnRlciIsInR5cGUiLCJtYXhEZXB0aCIsInByaW50SXRlcmF0b3JFbnRyaWVzIiwiZW50cmllcyIsImdldFJlY29yZEVudHJpZXMiLCJpIiwibmV4dCIsIl9rZXlzIiwibGVuZ3RoIiwia2V5IiwiZG9uZSIsImdldCIsInVuZGVmaW5lZCIsInByaW50SW1tdXRhYmxlUmVjb3JkIiwiX25hbWUiLCJwcmludEltbXV0YWJsZVNlcSIsIl9pdGVyIiwiX29iamVjdCIsIl9hcnJheSIsIl9jb2xsZWN0aW9uIiwiX2l0ZXJhYmxlIiwicHJpbnRJdGVyYXRvclZhbHVlcyIsInZhbHVlcyIsInByaW50SW1tdXRhYmxlVmFsdWVzIiwicGx1Z2luIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtC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QSxJQUFJLEVBQUpBO0FBRmEsQ0FBZjtBQUlBLElBQUlrRCxRQUFRLEdBQUdELE1BQWY7QUFDQXBELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQm1ELFFBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGV4cG9ydHMudGVzdCA9IGV4cG9ydHMuc2VyaWFsaXplID0gdm9pZCAwO1xuXG52YXIgX2NvbGxlY3Rpb25zID0gcmVxdWlyZSgnLi4vY29sbGVjdGlvbnMnKTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuLy8gU0VOVElORUwgY29uc3RhbnRzIGFyZSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9pbW11dGFibGUtanNcbmNvbnN0IElTX0lURVJBQkxFX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfSVRFUkFCTEVfX0BAJztcbmNvbnN0IElTX0xJU1RfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9MSVNUX19AQCc7XG5jb25zdCBJU19LRVlFRF9TRU5USU5FTCA9ICdAQF9fSU1NVVRBQkxFX0tFWUVEX19AQCc7XG5jb25zdCBJU19NQVBfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9NQVBfX0BAJztcbmNvbnN0IElTX09SREVSRURfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9PUkRFUkVEX19AQCc7XG5jb25zdCBJU19SRUNPUkRfU0VOVElORUwgPSAnQEBfX0lNTVVUQUJMRV9SRUNPUkRfX0BAJzsgLy8gaW1tdXRhYmxlIHY0XG5cbmNvbnN0IElTX1NFUV9TRU5USU5FTCA9ICdAQF9fSU1NVVRBQkxFX1NFUV9fQEAnO1xuY29uc3QgSVNfU0VUX1NFTlRJTkVMID0gJ0BAX19JTU1VVEFCTEVfU0VUX19AQCc7XG5jb25zdCBJU19TVEFDS19TRU5USU5FTCA9ICdAQF9fSU1NVVRBQkxFX1NUQUNLX19AQCc7XG5cbmNvbnN0IGdldEltbXV0YWJsZU5hbWUgPSBuYW1lID0+ICdJbW11dGFibGUuJyArIG5hbWU7XG5cbmNvbnN0IHByaW50QXNMZWFmID0gbmFtZSA9PiAnWycgKyBuYW1lICsgJ10nO1xuXG5jb25zdCBTUEFDRSA9ICcgJztcbmNvbnN0IExBWlkgPSAn4oCmJzsgLy8gU2VxIGlzIGxhenkgaWYgaXQgY2FsbHMgYSBtZXRob2QgbGlrZSBmaWx0ZXJcblxuY29uc3QgcHJpbnRJbW11dGFibGVFbnRyaWVzID0gKFxuICB2YWwsXG4gIGNvbmZpZyxcbiAgaW5kZW50YXRpb24sXG4gIGRlcHRoLFxuICByZWZzLFxuICBwcmludGVyLFxuICB0eXBlXG4pID0+XG4gICsrZGVwdGggPiBjb25maWcubWF4RGVwdGhcbiAgICA/IHByaW50QXNMZWFmKGdldEltbXV0YWJsZU5hbWUodHlwZSkpXG4gICAgOiBnZXRJbW11dGFibGVOYW1lKHR5cGUpICtcbiAgICAgIFNQQUNFICtcbiAgICAgICd7JyArXG4gICAgICAoMCwgX2NvbGxlY3Rpb25zLnByaW50SXRlcmF0b3JFbnRyaWVzKShcbiAgICAgICAgdmFsLmVudHJpZXMoKSxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBpbmRlbnRhdGlvbixcbiAgICAgICAgZGVwdGgsXG4gICAgICAgIHJlZnMsXG4gICAgICAgIHByaW50ZXJcbiAgICAgICkgK1xuICAgICAgJ30nOyAvLyBSZWNvcmQgaGFzIGFuIGVudHJpZXMgbWV0aG9kIGJlY2F1c2UgaXQgaXMgYSBjb2xsZWN0aW9uIGluIGltbXV0YWJsZSB2My5cbi8vIFJldHVybiBhbiBpdGVyYXRvciBmb3IgSW1tdXRhYmxlIFJlY29yZCBmcm9tIHZlcnNpb24gdjMgb3IgdjQuXG5cbmZ1bmN0aW9uIGdldFJlY29yZEVudHJpZXModmFsKSB7XG4gIGxldCBpID0gMDtcbiAgcmV0dXJuIHtcbiAgICBuZXh0KCkge1xuICAgICAgaWYgKGkgPCB2YWwuX2tleXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IHZhbC5fa2V5c1tpKytdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRvbmU6IGZhbHNlLFxuICAgICAgICAgIHZhbHVlOiBba2V5LCB2YWwuZ2V0KGtleSldXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgIH07XG4gICAgfVxuICB9O1xufVxuXG5jb25zdCBwcmludEltbXV0YWJsZVJlY29yZCA9IChcbiAgdmFsLFxuICBjb25maWcsXG4gIGluZGVudGF0aW9uLFxuICBkZXB0aCxcbiAgcmVmcyxcbiAgcHJpbnRlclxuKSA9PiB7XG4gIC8vIF9uYW1lIHByb3BlcnR5IGlzIGRlZmluZWQgb25seSBmb3IgYW4gSW1tdXRhYmxlIFJlY29yZCBpbnN0YW5jZVxuICAvLyB3aGljaCB3YXMgY29uc3RydWN0ZWQgd2l0aCBhIHNlY29uZCBvcHRpb25hbCBkZXNjcmlwdGl2ZSBuYW1lIGFyZ1xuICBjb25zdCBuYW1lID0gZ2V0SW1tdXRhYmxlTmFtZSh2YWwuX25hbWUgfHwgJ1JlY29yZCcpO1xuICByZXR1cm4gKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aFxuICAgID8gcHJpbnRBc0xlYWYobmFtZSlcbiAgICA6IG5hbWUgK1xuICAgICAgICBTUEFDRSArXG4gICAgICAgICd7JyArXG4gICAgICAgICgwLCBfY29sbGVjdGlvbnMucHJpbnRJdGVyYXRvckVudHJpZXMpKFxuICAgICAgICAgIGdldFJlY29yZEVudHJpZXModmFsKSxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgaW5kZW50YXRpb24sXG4gICAgICAgICAgZGVwdGgsXG4gICAgICAgICAgcmVmcyxcbiAgICAgICAgICBwcmludGVyXG4gICAgICAgICkgK1xuICAgICAgICAnfSc7XG59O1xuXG5jb25zdCBwcmludEltbXV0YWJsZVNlcSA9ICh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBnZXRJbW11dGFibGVOYW1lKCdTZXEnKTtcblxuICBpZiAoKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aCkge1xuICAgIHJldHVybiBwcmludEFzTGVhZihuYW1lKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfS0VZRURfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIG5hbWUgK1xuICAgICAgU1BBQ0UgK1xuICAgICAgJ3snICtcbiAgICAgICh2YWwuX2l0ZXIgfHwgdmFsLl9vYmplY3RcbiAgICAgICAgPyAoMCwgX2NvbGxlY3Rpb25zLnByaW50SXRlcmF0b3JFbnRyaWVzKShcbiAgICAgICAgICAgIHZhbC5lbnRyaWVzKCksXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBpbmRlbnRhdGlvbixcbiAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgcmVmcyxcbiAgICAgICAgICAgIHByaW50ZXJcbiAgICAgICAgICApXG4gICAgICAgIDogTEFaWSkgK1xuICAgICAgJ30nXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgbmFtZSArXG4gICAgU1BBQ0UgK1xuICAgICdbJyArXG4gICAgKHZhbC5faXRlciB8fCAvLyBmcm9tIEltbXV0YWJsZSBjb2xsZWN0aW9uIG9mIHZhbHVlc1xuICAgIHZhbC5fYXJyYXkgfHwgLy8gZnJvbSBFQ01BU2NyaXB0IGFycmF5XG4gICAgdmFsLl9jb2xsZWN0aW9uIHx8IC8vIGZyb20gRUNNQVNjcmlwdCBjb2xsZWN0aW9uIGluIGltbXV0YWJsZSB2NFxuICAgIHZhbC5faXRlcmFibGUgLy8gZnJvbSBFQ01BU2NyaXB0IGNvbGxlY3Rpb24gaW4gaW1tdXRhYmxlIHYzXG4gICAgICA/ICgwLCBfY29sbGVjdGlvbnMucHJpbnRJdGVyYXRvclZhbHVlcykoXG4gICAgICAgICAgdmFsLnZhbHVlcygpLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBpbmRlbnRhdGlvbixcbiAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICByZWZzLFxuICAgICAgICAgIHByaW50ZXJcbiAgICAgICAgKVxuICAgICAgOiBMQVpZKSArXG4gICAgJ10nXG4gICk7XG59O1xuXG5jb25zdCBwcmludEltbXV0YWJsZVZhbHVlcyA9IChcbiAgdmFsLFxuICBjb25maWcsXG4gIGluZGVudGF0aW9uLFxuICBkZXB0aCxcbiAgcmVmcyxcbiAgcHJpbnRlcixcbiAgdHlwZVxuKSA9PlxuICArK2RlcHRoID4gY29uZmlnLm1heERlcHRoXG4gICAgPyBwcmludEFzTGVhZihnZXRJbW11dGFibGVOYW1lKHR5cGUpKVxuICAgIDogZ2V0SW1tdXRhYmxlTmFtZSh0eXBlKSArXG4gICAgICBTUEFDRSArXG4gICAgICAnWycgK1xuICAgICAgKDAsIF9jb2xsZWN0aW9ucy5wcmludEl0ZXJhdG9yVmFsdWVzKShcbiAgICAgICAgdmFsLnZhbHVlcygpLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIGluZGVudGF0aW9uLFxuICAgICAgICBkZXB0aCxcbiAgICAgICAgcmVmcyxcbiAgICAgICAgcHJpbnRlclxuICAgICAgKSArXG4gICAgICAnXSc7XG5cbmNvbnN0IHNlcmlhbGl6ZSA9ICh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGlmICh2YWxbSVNfTUFQX1NFTlRJTkVMXSkge1xuICAgIHJldHVybiBwcmludEltbXV0YWJsZUVudHJpZXMoXG4gICAgICB2YWwsXG4gICAgICBjb25maWcsXG4gICAgICBpbmRlbnRhdGlvbixcbiAgICAgIGRlcHRoLFxuICAgICAgcmVmcyxcbiAgICAgIHByaW50ZXIsXG4gICAgICB2YWxbSVNfT1JERVJFRF9TRU5USU5FTF0gPyAnT3JkZXJlZE1hcCcgOiAnTWFwJ1xuICAgICk7XG4gIH1cblxuICBpZiAodmFsW0lTX0xJU1RfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIHByaW50SW1tdXRhYmxlVmFsdWVzKFxuICAgICAgdmFsLFxuICAgICAgY29uZmlnLFxuICAgICAgaW5kZW50YXRpb24sXG4gICAgICBkZXB0aCxcbiAgICAgIHJlZnMsXG4gICAgICBwcmludGVyLFxuICAgICAgJ0xpc3QnXG4gICAgKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfU0VUX1NFTlRJTkVMXSkge1xuICAgIHJldHVybiBwcmludEltbXV0YWJsZVZhbHVlcyhcbiAgICAgIHZhbCxcbiAgICAgIGNvbmZpZyxcbiAgICAgIGluZGVudGF0aW9uLFxuICAgICAgZGVwdGgsXG4gICAgICByZWZzLFxuICAgICAgcHJpbnRlcixcbiAgICAgIHZhbFtJU19PUkRFUkVEX1NFTlRJTkVMXSA/ICdPcmRlcmVkU2V0JyA6ICdTZXQnXG4gICAgKTtcbiAgfVxuXG4gIGlmICh2YWxbSVNfU1RBQ0tfU0VOVElORUxdKSB7XG4gICAgcmV0dXJuIHByaW50SW1tdXRhYmxlVmFsdWVzKFxuICAgICAgdmFsLFxuICAgICAgY29uZmlnLFxuICAgICAgaW5kZW50YXRpb24sXG4gICAgICBkZXB0aCxcbiAgICAgIHJlZnMsXG4gICAgICBwcmludGVyLFxuICAgICAgJ1N0YWNrJ1xuICAgICk7XG4gIH1cblxuICBpZiAodmFsW0lTX1NFUV9TRU5USU5FTF0pIHtcbiAgICByZXR1cm4gcHJpbnRJbW11dGFibGVTZXEodmFsLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcik7XG4gIH0gLy8gRm9yIGNvbXBhdGliaWxpdHkgd2l0aCBpbW11dGFibGUgdjMgYW5kIHY0LCBsZXQgcmVjb3JkIGJlIHRoZSBkZWZhdWx0LlxuXG4gIHJldHVybiBwcmludEltbXV0YWJsZVJlY29yZCh2YWwsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKTtcbn07IC8vIEV4cGxpY2l0bHkgY29tcGFyaW5nIHNlbnRpbmVsIHByb3BlcnRpZXMgdG8gdHJ1ZSBhdm9pZHMgZmFsc2UgcG9zaXRpdmVcbi8vIHdoZW4gbW9jayBpZGVudGl0eS1vYmotcHJveHkgcmV0dXJucyB0aGUga2V5IGFzIHRoZSB2YWx1ZSBmb3IgYW55IGtleS5cblxuZXhwb3J0cy5zZXJpYWxpemUgPSBzZXJpYWxpemU7XG5cbmNvbnN0IHRlc3QgPSB2YWwgPT5cbiAgdmFsICYmXG4gICh2YWxbSVNfSVRFUkFCTEVfU0VOVElORUxdID09PSB0cnVlIHx8IHZhbFtJU19SRUNPUkRfU0VOVElORUxdID09PSB0cnVlKTtcblxuZXhwb3J0cy50ZXN0ID0gdGVzdDtcbmNvbnN0IHBsdWdpbiA9IHtcbiAgc2VyaWFsaXplLFxuICB0ZXN0XG59O1xudmFyIF9kZWZhdWx0ID0gcGx1Z2luO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG4iXX0=