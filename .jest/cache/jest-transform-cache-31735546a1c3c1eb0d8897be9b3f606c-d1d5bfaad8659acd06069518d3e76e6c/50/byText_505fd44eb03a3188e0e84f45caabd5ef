7db5359268f3a9336aaaf25cb3a7077a
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.queryByText = exports.queryAllByText = exports.getByText = exports.getAllByText = exports.findByText = exports.findAllByText = void 0;

var React = _interopRequireWildcard(require("react"));

var _matches = require("../matches");

var _makeQueries = require("./makeQueries");

var _filterNodeByType = require("./filterNodeByType");

var _errors = require("./errors");

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

var getChildrenAsText = function getChildrenAsText(children, TextComponent) {
  var textContent = [];
  React.Children.forEach(children, function (child) {
    var _child$props;

    if (typeof child === 'string') {
      textContent.push(child);
      return;
    }

    if (typeof child === 'number') {
      textContent.push(child.toString());
      return;
    }

    if (child !== null && child !== void 0 && (_child$props = child.props) !== null && _child$props !== void 0 && _child$props.children) {
      if ((0, _filterNodeByType.filterNodeByType)(child, TextComponent) && textContent.length === 0) {
        return;
      }

      getChildrenAsText(child.props.children, TextComponent);
    }
  });
  return textContent;
};

var getNodeByText = function getNodeByText(node, text) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  try {
    var _require = require('react-native'),
        Text = _require.Text;

    var isTextComponent = (0, _filterNodeByType.filterNodeByType)(node, Text);

    if (isTextComponent) {
      var textChildren = getChildrenAsText(node.props.children, Text);

      if (textChildren) {
        var textToTest = textChildren.join('');
        var exact = options.exact,
            normalizer = options.normalizer;
        return (0, _matches.matches)(text, textToTest, normalizer, exact);
      }
    }

    return false;
  } catch (error) {
    throw (0, _errors.createLibraryNotSupportedError)(error);
  }
};

var queryAllByText = function queryAllByText(instance) {
  return function queryAllByTextFn(text, queryOptions) {
    var results = instance.findAll(function (node) {
      return getNodeByText(node, text, queryOptions);
    });
    return results;
  };
};

exports.queryAllByText = queryAllByText;

var getMultipleError = function getMultipleError(text) {
  return "Found multiple elements with text: " + String(text);
};

var getMissingError = function getMissingError(text) {
  return "Unable to find an element with text: " + String(text);
};

var _ref = (0, _makeQueries.makeQueries)(queryAllByText, getMissingError, getMultipleError),
    getByText = _ref.getBy,
    getAllByText = _ref.getAllBy,
    queryByText = _ref.queryBy,
    findByText = _ref.findBy,
    findAllByText = _ref.findAllBy;

exports.findAllByText = findAllByText;
exports.findByText = findByText;
exports.queryByText = queryByText;
exports.getAllByText = getAllByText;
exports.getByText = getByText;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ5VGV4dC5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInF1ZXJ5QnlUZXh0IiwicXVlcnlBbGxCeVRleHQiLCJnZXRCeVRleHQiLCJnZXRBbGxCeVRleHQiLCJmaW5kQnlUZXh0IiwiZmluZEFsbEJ5VGV4dCIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiX21hdGNoZXMiLCJfbWFrZVF1ZXJpZXMiLCJfZmlsdGVyTm9kZUJ5VHlwZSIsIl9lcnJvcnMiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJXZWFrTWFwIiwiY2FjaGUiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImhhcyIsImdldCIsIm5ld09iaiIsImhhc1Byb3BlcnR5RGVzY3JpcHRvciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJzZXQiLCJnZXRDaGlsZHJlbkFzVGV4dCIsImNoaWxkcmVuIiwiVGV4dENvbXBvbmVudCIsInRleHRDb250ZW50IiwiQ2hpbGRyZW4iLCJmb3JFYWNoIiwiY2hpbGQiLCJfY2hpbGQkcHJvcHMiLCJwdXNoIiwidG9TdHJpbmciLCJwcm9wcyIsImZpbHRlck5vZGVCeVR5cGUiLCJsZW5ndGgiLCJnZXROb2RlQnlUZXh0Iiwibm9kZSIsInRleHQiLCJvcHRpb25zIiwiVGV4dCIsImlzVGV4dENvbXBvbmVudCIsInRleHRDaGlsZHJlbiIsInRleHRUb1Rlc3QiLCJqb2luIiwiZXhhY3QiLCJub3JtYWxpemVyIiwibWF0Y2hlcyIsImVycm9yIiwiY3JlYXRlTGlicmFyeU5vdFN1cHBvcnRlZEVycm9yIiwiaW5zdGFuY2UiLCJxdWVyeUFsbEJ5VGV4dEZuIiwicXVlcnlPcHRpb25zIiwicmVzdWx0cyIsImZpbmRBbGwiLCJnZXRNdWx0aXBsZUVycm9yIiwiU3RyaW5nIiwiZ2V0TWlzc2luZ0Vycm9yIiwibWFrZVF1ZXJpZXMiLCJnZXRCeSIsImdldEFsbEJ5IiwicXVlcnlCeSIsImZpbmRCeSIsImZpbmRBbGxCeSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLFdBQVIsR0FBc0JGLE9BQU8sQ0FBQ0csY0FBUixHQUF5QkgsT0FBTyxDQUFDSSxTQUFSLEdBQW9CSixPQUFPLENBQUNLLFlBQVIsR0FBdUJMLE9BQU8sQ0FBQ00sVUFBUixHQUFxQk4sT0FBTyxDQUFDTyxhQUFSLEdBQXdCLEtBQUssQ0FBNUk7O0FBRUEsSUFBSUMsS0FBSyxHQUFHQyx1QkFBdUIsQ0FBQ0MsT0FBTyxDQUFDLE9BQUQsQ0FBUixDQUFuQzs7QUFFQSxJQUFJQyxRQUFRLEdBQUdELE9BQU8sY0FBdEI7O0FBRUEsSUFBSUUsWUFBWSxHQUFHRixPQUFPLGlCQUExQjs7QUFFQSxJQUFJRyxpQkFBaUIsR0FBR0gsT0FBTyxzQkFBL0I7O0FBRUEsSUFBSUksT0FBTyxHQUFHSixPQUFPLFlBQXJCOztBQUVBLFNBQVNLLHdCQUFULEdBQW9DO0FBQUUsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFVBQXZCLEVBQW1DLE9BQU8sSUFBUDtBQUFhLE1BQUlDLEtBQUssR0FBRyxJQUFJRCxPQUFKLEVBQVo7O0FBQTJCRCxFQUFBQSx3QkFBd0IsR0FBRyxvQ0FBWTtBQUFFLFdBQU9FLEtBQVA7QUFBZSxHQUF4RDs7QUFBMEQsU0FBT0EsS0FBUDtBQUFlOztBQUUxTCxTQUFTUix1QkFBVCxDQUFpQ1MsR0FBakMsRUFBc0M7QUFBRSxNQUFJQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ0MsVUFBZixFQUEyQjtBQUFFLFdBQU9ELEdBQVA7QUFBYTs7QUFBQyxNQUFJQSxHQUFHLEtBQUssSUFBUixJQUFnQixPQUFPQSxHQUFQLEtBQWUsUUFBZixJQUEy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aEI7QUFDQSxXQUFPQyxPQUFQO0FBQ0QsR0FIOEI7QUFBQSxDQUEvQjs7QUFLQTlELE9BQU8sQ0FBQ0csY0FBUixHQUF5QkEsY0FBekI7O0FBRUEsSUFBTTZELGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUIsQ0FBQWpCLElBQUk7QUFBQSxpREFBMENrQixNQUFNLENBQUNsQixJQUFELENBQWhEO0FBQUEsQ0FBN0I7O0FBRUEsSUFBTW1CLGVBQWUsR0FBRyxTQUFsQkEsZUFBa0IsQ0FBQW5CLElBQUk7QUFBQSxtREFBNENrQixNQUFNLENBQUNsQixJQUFELENBQWxEO0FBQUEsQ0FBNUI7O0FBRUEsV0FNSSxDQUFDLEdBQUduQyxZQUFZLENBQUN1RCxXQUFqQixFQUE4QmhFLGNBQTlCLEVBQThDK0QsZUFBOUMsRUFBK0RGLGdCQUEvRCxDQU5KO0FBQUEsSUFDUzVELFNBRFQsUUFDRWdFLEtBREY7QUFBQSxJQUVZL0QsWUFGWixRQUVFZ0UsUUFGRjtBQUFBLElBR1duRSxXQUhYLFFBR0VvRSxPQUhGO0FBQUEsSUFJVWhFLFVBSlYsUUFJRWlFLE1BSkY7QUFBQSxJQUthaEUsYUFMYixRQUtFaUUsU0FMRjs7QUFPQXhFLE9BQU8sQ0FBQ08sYUFBUixHQUF3QkEsYUFBeEI7QUFDQVAsT0FBTyxDQUFDTSxVQUFSLEdBQXFCQSxVQUFyQjtBQUNBTixPQUFPLENBQUNFLFdBQVIsR0FBc0JBLFdBQXRCO0FBQ0FGLE9BQU8sQ0FBQ0ssWUFBUixHQUF1QkEsWUFBdkI7QUFDQUwsT0FBTyxDQUFDSSxTQUFSLEdBQW9CQSxTQUFwQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5xdWVyeUJ5VGV4dCA9IGV4cG9ydHMucXVlcnlBbGxCeVRleHQgPSBleHBvcnRzLmdldEJ5VGV4dCA9IGV4cG9ydHMuZ2V0QWxsQnlUZXh0ID0gZXhwb3J0cy5maW5kQnlUZXh0ID0gZXhwb3J0cy5maW5kQWxsQnlUZXh0ID0gdm9pZCAwO1xuXG52YXIgUmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKFwicmVhY3RcIikpO1xuXG52YXIgX21hdGNoZXMgPSByZXF1aXJlKFwiLi4vbWF0Y2hlc1wiKTtcblxudmFyIF9tYWtlUXVlcmllcyA9IHJlcXVpcmUoXCIuL21ha2VRdWVyaWVzXCIpO1xuXG52YXIgX2ZpbHRlck5vZGVCeVR5cGUgPSByZXF1aXJlKFwiLi9maWx0ZXJOb2RlQnlUeXBlXCIpO1xuXG52YXIgX2Vycm9ycyA9IHJlcXVpcmUoXCIuL2Vycm9yc1wiKTtcblxuZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCkgeyBpZiAodHlwZW9mIFdlYWtNYXAgIT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIG51bGw7IHZhciBjYWNoZSA9IG5ldyBXZWFrTWFwKCk7IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNhY2hlOyB9OyByZXR1cm4gY2FjaGU7IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJmdW5jdGlvblwiKSB7IHJldHVybiB7IGRlZmF1bHQ6IG9iaiB9OyB9IHZhciBjYWNoZSA9IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSgpOyBpZiAoY2FjaGUgJiYgY2FjaGUuaGFzKG9iaikpIHsgcmV0dXJuIGNhY2hlLmdldChvYmopOyB9IHZhciBuZXdPYmogPSB7fTsgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOyBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyBpZiAoY2FjaGUpIHsgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTsgfSByZXR1cm4gbmV3T2JqOyB9XG5cbmNvbnN0IGdldENoaWxkcmVuQXNUZXh0ID0gKGNoaWxkcmVuLCBUZXh0Q29tcG9uZW50KSA9PiB7XG4gIGNvbnN0IHRleHRDb250ZW50ID0gW107XG4gIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIGNoaWxkID0+IHtcbiAgICB2YXIgX2NoaWxkJHByb3BzO1xuXG4gICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRleHRDb250ZW50LnB1c2goY2hpbGQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgY2hpbGQgPT09ICdudW1iZXInKSB7XG4gICAgICB0ZXh0Q29udGVudC5wdXNoKGNoaWxkLnRvU3RyaW5nKCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjaGlsZCAhPT0gbnVsbCAmJiBjaGlsZCAhPT0gdm9pZCAwICYmIChfY2hpbGQkcHJvcHMgPSBjaGlsZC5wcm9wcykgIT09IG51bGwgJiYgX2NoaWxkJHByb3BzICE9PSB2b2lkIDAgJiYgX2NoaWxkJHByb3BzLmNoaWxkcmVuKSB7XG4gICAgICAvLyBCYWlsIG9uIHRyYXZlcnNpbmcgdGV4dCBjaGlsZHJlbiBkb3duIHRoZSB0cmVlIGlmIGN1cnJlbnQgbm9kZSAoY2hpbGQpXG4gICAgICAvLyBoYXMgbm8gdGV4dC4gSW4gc3VjaCBzaXR1YXRpb25zLCByZWFjdC10ZXN0LXJlbmRlcmVyIHdpbGwgdHJhdmVyc2UgZG93blxuICAgICAgLy8gdGhpcyB0cmVlIGluIGEgc2VwYXJhdGUgY2FsbCBhbmQgcnVuIHRoaXMgcXVlcnkgYWdhaW4uIEFzIGEgcmVzdWx0LCB0aGVcbiAgICAgIC8vIHF1ZXJ5IHdpbGwgbWF0Y2ggdGhlIGRlZXBlc3QgdGV4dCBub2RlIHRoYXQgbWF0Y2hlcyByZXF1ZXN0ZWQgdGV4dC5cbiAgICAgIGlmICgoMCwgX2ZpbHRlck5vZGVCeVR5cGUuZmlsdGVyTm9kZUJ5VHlwZSkoY2hpbGQsIFRleHRDb21wb25lbnQpICYmIHRleHRDb250ZW50Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGdldENoaWxkcmVuQXNUZXh0KGNoaWxkLnByb3BzLmNoaWxkcmVuLCBUZXh0Q29tcG9uZW50KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdGV4dENvbnRlbnQ7XG59O1xuXG5jb25zdCBnZXROb2RlQnlUZXh0ID0gKG5vZGUsIHRleHQsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHtcbiAgICAgIFRleHRcbiAgICB9ID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJyk7XG5cbiAgICBjb25zdCBpc1RleHRDb21wb25lbnQgPSAoMCwgX2ZpbHRlck5vZGVCeVR5cGUuZmlsdGVyTm9kZUJ5VHlwZSkobm9kZSwgVGV4dCk7XG5cbiAgICBpZiAoaXNUZXh0Q29tcG9uZW50KSB7XG4gICAgICBjb25zdCB0ZXh0Q2hpbGRyZW4gPSBnZXRDaGlsZHJlbkFzVGV4dChub2RlLnByb3BzLmNoaWxkcmVuLCBUZXh0KTtcblxuICAgICAgaWYgKHRleHRDaGlsZHJlbikge1xuICAgICAgICBjb25zdCB0ZXh0VG9UZXN0ID0gdGV4dENoaWxkcmVuLmpvaW4oJycpO1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZXhhY3QsXG4gICAgICAgICAgbm9ybWFsaXplclxuICAgICAgICB9ID0gb3B0aW9ucztcbiAgICAgICAgcmV0dXJuICgwLCBfbWF0Y2hlcy5tYXRjaGVzKSh0ZXh0LCB0ZXh0VG9UZXN0LCBub3JtYWxpemVyLCBleGFjdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93ICgwLCBfZXJyb3JzLmNyZWF0ZUxpYnJhcnlOb3RTdXBwb3J0ZWRFcnJvcikoZXJyb3IpO1xuICB9XG59O1xuXG5jb25zdCBxdWVyeUFsbEJ5VGV4dCA9IGluc3RhbmNlID0+IGZ1bmN0aW9uIHF1ZXJ5QWxsQnlUZXh0Rm4odGV4dCwgcXVlcnlPcHRpb25zKSB7XG4gIGNvbnN0IHJlc3VsdHMgPSBpbnN0YW5jZS5maW5kQWxsKG5vZGUgPT4gZ2V0Tm9kZUJ5VGV4dChub2RlLCB0ZXh0LCBxdWVyeU9wdGlvbnMpKTtcbiAgcmV0dXJuIHJlc3VsdHM7XG59O1xuXG5leHBvcnRzLnF1ZXJ5QWxsQnlUZXh0ID0gcXVlcnlBbGxCeVRleHQ7XG5cbmNvbnN0IGdldE11bHRpcGxlRXJyb3IgPSB0ZXh0ID0+IGBGb3VuZCBtdWx0aXBsZSBlbGVtZW50cyB3aXRoIHRleHQ6ICR7U3RyaW5nKHRleHQpfWA7XG5cbmNvbnN0IGdldE1pc3NpbmdFcnJvciA9IHRleHQgPT4gYFVuYWJsZSB0byBmaW5kIGFuIGVsZW1lbnQgd2l0aCB0ZXh0OiAke1N0cmluZyh0ZXh0KX1gO1xuXG5jb25zdCB7XG4gIGdldEJ5OiBnZXRCeVRleHQsXG4gIGdldEFsbEJ5OiBnZXRBbGxCeVRleHQsXG4gIHF1ZXJ5Qnk6IHF1ZXJ5QnlUZXh0LFxuICBmaW5kQnk6IGZpbmRCeVRleHQsXG4gIGZpbmRBbGxCeTogZmluZEFsbEJ5VGV4dFxufSA9ICgwLCBfbWFrZVF1ZXJpZXMubWFrZVF1ZXJpZXMpKHF1ZXJ5QWxsQnlUZXh0LCBnZXRNaXNzaW5nRXJyb3IsIGdldE11bHRpcGxlRXJyb3IpO1xuZXhwb3J0cy5maW5kQWxsQnlUZXh0ID0gZmluZEFsbEJ5VGV4dDtcbmV4cG9ydHMuZmluZEJ5VGV4dCA9IGZpbmRCeVRleHQ7XG5leHBvcnRzLnF1ZXJ5QnlUZXh0ID0gcXVlcnlCeVRleHQ7XG5leHBvcnRzLmdldEFsbEJ5VGV4dCA9IGdldEFsbEJ5VGV4dDtcbmV4cG9ydHMuZ2V0QnlUZXh0ID0gZ2V0QnlUZXh0OyJdfQ==