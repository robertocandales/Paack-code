bb7d35503d6fbca9414098af7d0d826a
"use strict";

exports.__esModule = true;
exports.createSelectorHook = createSelectorHook;
exports.useSelector = void 0;

var _react = require("react");

var _useReduxContext2 = require("./useReduxContext");

var _Subscription = require("../utils/Subscription");

var _useIsomorphicLayoutEffect = require("../utils/useIsomorphicLayoutEffect");

var _Context = require("../components/Context");

var refEquality = function refEquality(a, b) {
  return a === b;
};

function useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub) {
  var _useReducer = (0, _react.useReducer)(function (s) {
    return s + 1;
  }, 0),
      forceRender = _useReducer[1];

  var subscription = (0, _react.useMemo)(function () {
    return (0, _Subscription.createSubscription)(store, contextSub);
  }, [store, contextSub]);
  var latestSubscriptionCallbackError = (0, _react.useRef)();
  var latestSelector = (0, _react.useRef)();
  var latestStoreState = (0, _react.useRef)();
  var latestSelectedState = (0, _react.useRef)();
  var storeState = store.getState();
  var selectedState;

  try {
    if (selector !== latestSelector.current || storeState !== latestStoreState.current || latestSubscriptionCallbackError.current) {
      var newSelectedState = selector(storeState);

      if (latestSelectedState.current === undefined || !equalityFn(newSelectedState, latestSelectedState.current)) {
        selectedState = newSelectedState;
      } else {
        selectedState = latestSelectedState.current;
      }
    } else {
      selectedState = latestSelectedState.current;
    }
  } catch (err) {
    if (latestSubscriptionCallbackError.current) {
      err.message += "\nThe error may be correlated with this previous error:\n" + latestSubscriptionCallbackError.current.stack + "\n\n";
    }

    throw err;
  }

  (0, _useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function () {
    latestSelector.current = selector;
    latestStoreState.current = storeState;
    latestSelectedState.current = selectedState;
    latestSubscriptionCallbackError.current = undefined;
  });
  (0, _useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function () {
    function checkForUpdates() {
      try {
        var newStoreState = store.getState();

        if (newStoreState === latestStoreState.current) {
          return;
        }

        var _newSelectedState = latestSelector.current(newStoreState);

        if (equalityFn(_newSelectedState, latestSelectedState.current)) {
          return;
        }

        latestSelectedState.current = _newSelectedState;
        latestStoreState.current = newStoreState;
      } catch (err) {
        latestSubscriptionCallbackError.current = err;
      }

      forceRender();
    }

    subscription.onStateChange = checkForUpdates;
    subscription.trySubscribe();
    checkForUpdates();
    return function () {
      return subscription.tryUnsubscribe();
    };
  }, [store, subscription]);
  return selectedState;
}

function createSelectorHook(context) {
  if (context === void 0) {
    context = _Context.ReactReduxContext;
  }

  var useReduxContext = context === _Context.ReactReduxContext ? _useReduxContext2.useReduxContext : function () {
    return (0, _react.useContext)(context);
  };
  return function useSelector(selector, equalityFn) {
    if (equalityFn === void 0) {
      equalityFn = refEquality;
    }

    if (process.env.NODE_ENV !== 'production') {
      if (!selector) {
        throw new Error("You must pass a selector to useSelector");
      }

      if (typeof selector !== 'function') {
        throw new Error("You must pass a function as a selector to useSelector");
      }

      if (typeof equalityFn !== 'function') {
        throw new Error("You must pass a function as an equality function to useSelector");
      }
    }

    var _useReduxContext = useReduxContext(),
        store = _useReduxContext.store,
        contextSub = _useReduxContext.subscription;

    var selectedState = useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub);
    (0, _react.useDebugValue)(selectedState);
    return selectedState;
  };
}

var useSelector = createSelectorHook();
exports.useSelector = useSelector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZVNlbGVjdG9yLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiY3JlYXRlU2VsZWN0b3JIb29rIiwidXNlU2VsZWN0b3IiLCJfcmVhY3QiLCJyZXF1aXJlIiwiX3VzZVJlZHV4Q29udGV4dDIiLCJfU3Vic2NyaXB0aW9uIiwiX3VzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QiLCJfQ29udGV4dCIsInJlZkVxdWFsaXR5IiwiYSIsImIiLCJ1c2VTZWxlY3RvcldpdGhTdG9yZUFuZFN1YnNjcmlwdGlvbiIsInNlbGVjdG9yIiwiZXF1YWxpdHlGbiIsInN0b3JlIiwiY29udGV4dFN1YiIsIl91c2VSZWR1Y2VyIiwidXNlUmVkdWNlciIsInMiLCJmb3JjZVJlbmRlciIsInN1YnNjcmlwdGlvbiIsInVzZU1lbW8iLCJjcmVhdGVTdWJzY3JpcHRpb24iLCJsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yIiwidXNlUmVmIiwibGF0ZXN0U2VsZWN0b3IiLCJsYXRlc3RTdG9yZVN0YXRlIiwibGF0ZXN0U2VsZWN0ZWRTdGF0ZSIsInN0b3JlU3RhdGUiLCJnZXRTdGF0ZSIsInNlbGVjdGVkU3RhdGUiLCJjdXJyZW50IiwibmV3U2VsZWN0ZWRTdGF0ZSIsInVuZGVmaW5lZCIsImVyciIsIm1lc3NhZ2UiLCJzdGFjayIsInVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QiLCJjaGVja0ZvclVwZGF0ZXMiLCJuZXdTdG9yZVN0YXRlIiwiX25ld1NlbGVjdGVkU3RhdGUiLCJvblN0YXRlQ2hhbmdlIiwidHJ5U3Vic2NyaWJlIiwidHJ5VW5zdWJzY3JpYmUiLCJjb250ZXh0IiwiUmVhY3RSZWR1eENvbnRleHQiLCJ1c2VSZWR1eENvbnRleHQiLCJ1c2VDb250ZXh0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiRXJyb3IiLCJfdXNlUmVkdXhDb250ZXh0IiwidXNlRGVidWdWYWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE9BQU8sQ0FB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QXZCLEVBQThCQyxVQUE5QixDQUF2RDtBQUNBLEtBQUMsR0FBR2IsTUFBTSxDQUFDbUQsYUFBWCxFQUEwQnZCLGFBQTFCO0FBQ0EsV0FBT0EsYUFBUDtBQUNELEdBMUJEO0FBMkJEOztBQTBCRCxJQUFJN0IsV0FBVyxHQUFnQkQsa0JBQWtCLEVBQWpEO0FBQ0FGLE9BQU8sQ0FBQ0csV0FBUixHQUFzQkEsV0FBdEIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuY3JlYXRlU2VsZWN0b3JIb29rID0gY3JlYXRlU2VsZWN0b3JIb29rO1xuZXhwb3J0cy51c2VTZWxlY3RvciA9IHZvaWQgMDtcblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcblxudmFyIF91c2VSZWR1eENvbnRleHQyID0gcmVxdWlyZShcIi4vdXNlUmVkdXhDb250ZXh0XCIpO1xuXG52YXIgX1N1YnNjcmlwdGlvbiA9IHJlcXVpcmUoXCIuLi91dGlscy9TdWJzY3JpcHRpb25cIik7XG5cbnZhciBfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCA9IHJlcXVpcmUoXCIuLi91dGlscy91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0XCIpO1xuXG52YXIgX0NvbnRleHQgPSByZXF1aXJlKFwiLi4vY29tcG9uZW50cy9Db250ZXh0XCIpO1xuXG52YXIgcmVmRXF1YWxpdHkgPSBmdW5jdGlvbiByZWZFcXVhbGl0eShhLCBiKSB7XG4gIHJldHVybiBhID09PSBiO1xufTtcblxuZnVuY3Rpb24gdXNlU2VsZWN0b3JXaXRoU3RvcmVBbmRTdWJzY3JpcHRpb24oc2VsZWN0b3IsIGVxdWFsaXR5Rm4sIHN0b3JlLCBjb250ZXh0U3ViKSB7XG4gIHZhciBfdXNlUmVkdWNlciA9ICgwLCBfcmVhY3QudXNlUmVkdWNlcikoZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gcyArIDE7XG4gIH0sIDApLFxuICAgICAgZm9yY2VSZW5kZXIgPSBfdXNlUmVkdWNlclsxXTtcblxuICB2YXIgc3Vic2NyaXB0aW9uID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICgwLCBfU3Vic2NyaXB0aW9uLmNyZWF0ZVN1YnNjcmlwdGlvbikoc3RvcmUsIGNvbnRleHRTdWIpO1xuICB9LCBbc3RvcmUsIGNvbnRleHRTdWJdKTtcbiAgdmFyIGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IgPSAoMCwgX3JlYWN0LnVzZVJlZikoKTtcbiAgdmFyIGxhdGVzdFNlbGVjdG9yID0gKDAsIF9yZWFjdC51c2VSZWYpKCk7XG4gIHZhciBsYXRlc3RTdG9yZVN0YXRlID0gKDAsIF9yZWFjdC51c2VSZWYpKCk7XG4gIHZhciBsYXRlc3RTZWxlY3RlZFN0YXRlID0gKDAsIF9yZWFjdC51c2VSZWYpKCk7XG4gIHZhciBzdG9yZVN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgdmFyIHNlbGVjdGVkU3RhdGU7XG5cbiAgdHJ5IHtcbiAgICBpZiAoc2VsZWN0b3IgIT09IGxhdGVzdFNlbGVjdG9yLmN1cnJlbnQgfHwgc3RvcmVTdGF0ZSAhPT0gbGF0ZXN0U3RvcmVTdGF0ZS5jdXJyZW50IHx8IGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IuY3VycmVudCkge1xuICAgICAgdmFyIG5ld1NlbGVjdGVkU3RhdGUgPSBzZWxlY3RvcihzdG9yZVN0YXRlKTsgLy8gZW5zdXJlIGxhdGVzdCBzZWxlY3RlZCBzdGF0ZSBpcyByZXVzZWQgc28gdGhhdCBhIGN1c3RvbSBlcXVhbGl0eSBmdW5jdGlvbiBjYW4gcmVzdWx0IGluIGlkZW50aWNhbCByZWZlcmVuY2VzXG5cbiAgICAgIGlmIChsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQgPT09IHVuZGVmaW5lZCB8fCAhZXF1YWxpdHlGbihuZXdTZWxlY3RlZFN0YXRlLCBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQpKSB7XG4gICAgICAgIHNlbGVjdGVkU3RhdGUgPSBuZXdTZWxlY3RlZFN0YXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZWN0ZWRTdGF0ZSA9IGxhdGVzdFNlbGVjdGVkU3RhdGUuY3VycmVudDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZWN0ZWRTdGF0ZSA9IGxhdGVzdFNlbGVjdGVkU3RhdGUuY3VycmVudDtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQpIHtcbiAgICAgIGVyci5tZXNzYWdlICs9IFwiXFxuVGhlIGVycm9yIG1heSBiZSBjb3JyZWxhdGVkIHdpdGggdGhpcyBwcmV2aW91cyBlcnJvcjpcXG5cIiArIGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IuY3VycmVudC5zdGFjayArIFwiXFxuXFxuXCI7XG4gICAgfVxuXG4gICAgdGhyb3cgZXJyO1xuICB9XG5cbiAgKDAsIF91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0LnVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QpKGZ1bmN0aW9uICgpIHtcbiAgICBsYXRlc3RTZWxlY3Rvci5jdXJyZW50ID0gc2VsZWN0b3I7XG4gICAgbGF0ZXN0U3RvcmVTdGF0ZS5jdXJyZW50ID0gc3RvcmVTdGF0ZTtcbiAgICBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQgPSBzZWxlY3RlZFN0YXRlO1xuICAgIGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IuY3VycmVudCA9IHVuZGVmaW5lZDtcbiAgfSk7XG4gICgwLCBfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdC51c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KShmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gY2hlY2tGb3JVcGRhdGVzKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIG5ld1N0b3JlU3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpOyAvLyBBdm9pZCBjYWxsaW5nIHNlbGVjdG9yIG11bHRpcGxlIHRpbWVzIGlmIHRoZSBzdG9yZSdzIHN0YXRlIGhhcyBub3QgY2hhbmdlZFxuXG4gICAgICAgIGlmIChuZXdTdG9yZVN0YXRlID09PSBsYXRlc3RTdG9yZVN0YXRlLmN1cnJlbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgX25ld1NlbGVjdGVkU3RhdGUgPSBsYXRlc3RTZWxlY3Rvci5jdXJyZW50KG5ld1N0b3JlU3RhdGUpO1xuXG4gICAgICAgIGlmIChlcXVhbGl0eUZuKF9uZXdTZWxlY3RlZFN0YXRlLCBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGF0ZXN0U2VsZWN0ZWRTdGF0ZS5jdXJyZW50ID0gX25ld1NlbGVjdGVkU3RhdGU7XG4gICAgICAgIGxhdGVzdFN0b3JlU3RhdGUuY3VycmVudCA9IG5ld1N0b3JlU3RhdGU7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgaWdub3JlIGFsbCBlcnJvcnMgaGVyZSwgc2luY2Ugd2hlbiB0aGUgY29tcG9uZW50XG4gICAgICAgIC8vIGlzIHJlLXJlbmRlcmVkLCB0aGUgc2VsZWN0b3JzIGFyZSBjYWxsZWQgYWdhaW4sIGFuZFxuICAgICAgICAvLyB3aWxsIHRocm93IGFnYWluLCBpZiBuZWl0aGVyIHByb3BzIG5vciBzdG9yZSBzdGF0ZVxuICAgICAgICAvLyBjaGFuZ2VkXG4gICAgICAgIGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IuY3VycmVudCA9IGVycjtcbiAgICAgIH1cblxuICAgICAgZm9yY2VSZW5kZXIoKTtcbiAgICB9XG5cbiAgICBzdWJzY3JpcHRpb24ub25TdGF0ZUNoYW5nZSA9IGNoZWNrRm9yVXBkYXRlcztcbiAgICBzdWJzY3JpcHRpb24udHJ5U3Vic2NyaWJlKCk7XG4gICAgY2hlY2tGb3JVcGRhdGVzKCk7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICB9LCBbc3RvcmUsIHN1YnNjcmlwdGlvbl0pO1xuICByZXR1cm4gc2VsZWN0ZWRTdGF0ZTtcbn1cbi8qKlxuICogSG9vayBmYWN0b3J5LCB3aGljaCBjcmVhdGVzIGEgYHVzZVNlbGVjdG9yYCBob29rIGJvdW5kIHRvIGEgZ2l2ZW4gY29udGV4dC5cbiAqXG4gKiBAcGFyYW0ge1JlYWN0LkNvbnRleHR9IFtjb250ZXh0PVJlYWN0UmVkdXhDb250ZXh0XSBDb250ZXh0IHBhc3NlZCB0byB5b3VyIGA8UHJvdmlkZXI+YC5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBgdXNlU2VsZWN0b3JgIGhvb2sgYm91bmQgdG8gdGhlIHNwZWNpZmllZCBjb250ZXh0LlxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlU2VsZWN0b3JIb29rKGNvbnRleHQpIHtcbiAgaWYgKGNvbnRleHQgPT09IHZvaWQgMCkge1xuICAgIGNvbnRleHQgPSBfQ29udGV4dC5SZWFjdFJlZHV4Q29udGV4dDtcbiAgfVxuXG4gIHZhciB1c2VSZWR1eENvbnRleHQgPSBjb250ZXh0ID09PSBfQ29udGV4dC5SZWFjdFJlZHV4Q29udGV4dCA/IF91c2VSZWR1eENvbnRleHQyLnVzZVJlZHV4Q29udGV4dCA6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gKDAsIF9yZWFjdC51c2VDb250ZXh0KShjb250ZXh0KTtcbiAgfTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVzZVNlbGVjdG9yKHNlbGVjdG9yLCBlcXVhbGl0eUZuKSB7XG4gICAgaWYgKGVxdWFsaXR5Rm4gPT09IHZvaWQgMCkge1xuICAgICAgZXF1YWxpdHlGbiA9IHJlZkVxdWFsaXR5O1xuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBtdXN0IHBhc3MgYSBzZWxlY3RvciB0byB1c2VTZWxlY3RvclwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgbXVzdCBwYXNzIGEgZnVuY3Rpb24gYXMgYSBzZWxlY3RvciB0byB1c2VTZWxlY3RvclwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBlcXVhbGl0eUZuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIllvdSBtdXN0IHBhc3MgYSBmdW5jdGlvbiBhcyBhbiBlcXVhbGl0eSBmdW5jdGlvbiB0byB1c2VTZWxlY3RvclwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgX3VzZVJlZHV4Q29udGV4dCA9IHVzZVJlZHV4Q29udGV4dCgpLFxuICAgICAgICBzdG9yZSA9IF91c2VSZWR1eENvbnRleHQuc3RvcmUsXG4gICAgICAgIGNvbnRleHRTdWIgPSBfdXNlUmVkdXhDb250ZXh0LnN1YnNjcmlwdGlvbjtcblxuICAgIHZhciBzZWxlY3RlZFN0YXRlID0gdXNlU2VsZWN0b3JXaXRoU3RvcmVBbmRTdWJzY3JpcHRpb24oc2VsZWN0b3IsIGVxdWFsaXR5Rm4sIHN0b3JlLCBjb250ZXh0U3ViKTtcbiAgICAoMCwgX3JlYWN0LnVzZURlYnVnVmFsdWUpKHNlbGVjdGVkU3RhdGUpO1xuICAgIHJldHVybiBzZWxlY3RlZFN0YXRlO1xuICB9O1xufVxuLyoqXG4gKiBBIGhvb2sgdG8gYWNjZXNzIHRoZSByZWR1eCBzdG9yZSdzIHN0YXRlLiBUaGlzIGhvb2sgdGFrZXMgYSBzZWxlY3RvciBmdW5jdGlvblxuICogYXMgYW4gYXJndW1lbnQuIFRoZSBzZWxlY3RvciBpcyBjYWxsZWQgd2l0aCB0aGUgc3RvcmUgc3RhdGUuXG4gKlxuICogVGhpcyBob29rIHRha2VzIGFuIG9wdGlvbmFsIGVxdWFsaXR5IGNvbXBhcmlzb24gZnVuY3Rpb24gYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXJcbiAqIHRoYXQgYWxsb3dzIHlvdSB0byBjdXN0b21pemUgdGhlIHdheSB0aGUgc2VsZWN0ZWQgc3RhdGUgaXMgY29tcGFyZWQgdG8gZGV0ZXJtaW5lXG4gKiB3aGV0aGVyIHRoZSBjb21wb25lbnQgbmVlZHMgdG8gYmUgcmUtcmVuZGVyZWQuXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uXG4gKiBAcGFyYW0ge0Z1bmN0aW9uPX0gZXF1YWxpdHlGbiB0aGUgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIHVzZWQgdG8gZGV0ZXJtaW5lIGVxdWFsaXR5XG4gKlxuICogQHJldHVybnMge2FueX0gdGhlIHNlbGVjdGVkIHN0YXRlXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnXG4gKiBpbXBvcnQgeyB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4J1xuICpcbiAqIGV4cG9ydCBjb25zdCBDb3VudGVyQ29tcG9uZW50ID0gKCkgPT4ge1xuICogICBjb25zdCBjb3VudGVyID0gdXNlU2VsZWN0b3Ioc3RhdGUgPT4gc3RhdGUuY291bnRlcilcbiAqICAgcmV0dXJuIDxkaXY+e2NvdW50ZXJ9PC9kaXY+XG4gKiB9XG4gKi9cblxuXG52YXIgdXNlU2VsZWN0b3IgPSAvKiNfX1BVUkVfXyovY3JlYXRlU2VsZWN0b3JIb29rKCk7XG5leHBvcnRzLnVzZVNlbGVjdG9yID0gdXNlU2VsZWN0b3I7Il19